<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Earth observation data cubes | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes</title>
<meta name="author" content="Gilberto Camara">
<meta name="author" content="Rolf Simoes">
<meta name="author" content="Felipe Souza">
<meta name="author" content="Charlotte Pelletier">
<meta name="author" content="Alber Sanchez">
<meta name="author" content="Pedro R. Andrade">
<meta name="author" content="Karine Ferreira">
<meta name="author" content="Gilberto Queiroz">
<meta name="description" content="Analysis-ready data image collections Analysis-ready data (ARD) are images that are ready for analysis without the need for further preprocessing or transformation. They simplify and accelerate...">
<meta name="generator" content="bookdown 0.36 with bs4_book()">
<meta property="og:title" content="Earth observation data cubes | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover_sits_book.png">
<meta property="og:description" content="Analysis-ready data image collections Analysis-ready data (ARD) are images that are ready for analysis without the need for further preprocessing or transformation. They simplify and accelerate...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Earth observation data cubes | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta name="twitter:description" content="Analysis-ready data image collections Analysis-ready data (ARD) are images that are ready for analysis without the need for further preprocessing or transformation. They simplify and accelerate...">
<meta name="twitter:image" content="/images/cover_sits_book.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/IBM_Plex_Serif-0.4.7/font.css" rel="stylesheet">
<link href="libs/IBM_Plex_Mono-0.4.7/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.6.0/transition.js"></script><script src="libs/bs3compat-0.6.0/tabs.js"></script><script src="libs/bs3compat-0.6.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="setup.html">Setup</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li><a class="active" href="earth-observation-data-cubes.html">Earth observation data cubes</a></li>
<li><a class="" href="operations-on-data-cubes.html">Operations on data cubes</a></li>
<li><a class="" href="working-with-time-series.html">Working with time series</a></li>
<li><a class="" href="improving-the-quality-of-training-samples.html">Improving the quality of training samples</a></li>
<li><a class="" href="machine-learning-for-data-cubes.html">Machine learning for data cubes</a></li>
<li><a class="" href="classification-of-raster-data-cubes.html">Classification of raster data cubes</a></li>
<li><a class="" href="bayesian-smoothing-for-post-processing.html">Bayesian smoothing for post-processing</a></li>
<li><a class="" href="validation-and-accuracy-measurements.html">Validation and accuracy measurements</a></li>
<li><a class="" href="uncertainty-and-active-learning.html">Uncertainty and active learning</a></li>
<li><a class="" href="ensemble-prediction-from-multiple-models.html">Ensemble prediction from multiple models</a></li>
<li><a class="" href="object-based-time-series-image-analysis.html">Object-based time series image analysis</a></li>
<li><a class="" href="technical-annex.html">Technical annex</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="earth-observation-data-cubes" class="section level1 unnumbered">
<h1>Earth observation data cubes<a class="anchor" aria-label="anchor" href="#earth-observation-data-cubes"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://www.kaggle.com/code/esensing/creating-data-cubes-in-sits" target="_blank"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a></p>
<div id="analysis-ready-data-image-collections" class="section level2 unnumbered">
<h2>Analysis-ready data image collections<a class="anchor" aria-label="anchor" href="#analysis-ready-data-image-collections"><i class="fas fa-link"></i></a>
</h2>
<p>Analysis-ready data (ARD) are images that are ready for analysis without the need for further preprocessing or transformation. They simplify and accelerate the analysis of Earth observation data by providing consistent and high-quality data that are standardized across different sensors and platforms. ARD data is typically provided as a collection of files, where each pixel contains a single value for each spectral band for a given date.</p>
<p>ARD collections are available in cloud services such as Amazon Web Service, Brazil Data Cube, Digital Earth Africa, Swiss Data Cube, and Microsoft’s Planetary Computer. These collections have been processed to improve multidate comparability. Radiance measures at the top of the atmosphere were converted to ground reflectance measures. In general, the timelines of the images of an ARD collection are different. Images still contain cloudy or missing pixels; bands for the images in the collection may have different resolutions. Figure <a href="earth-observation-data-cubes.html#fig:ardt">9</a> shows an example of the Landsat ARD image collection.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ardt"></span>
<img src="images/usgs_ard_tile.png" alt="ARD image collection (Source: USGS. Reproduction based on fair use doctrine)." width="80%"><p class="caption">
Figure 9: ARD image collection (Source: USGS. Reproduction based on fair use doctrine).
</p>
</div>
<p>ARD image collections are organized in spatial partitions. Sentinel-2/2A images follow the Military Grid Reference System (MGRS) tiling system, which divides the world into 60 UTM zones of 8 degrees of longitude. Each zone has blocks of 6 degrees of latitude. Blocks are split into tiles of 110 <span class="math inline">\(\times\)</span> 110 km<span class="math inline">\(^2\)</span> with a 10 km overlap. Figure <a href="earth-observation-data-cubes.html#fig:mgrs">10</a> shows the MGRS tiling system for a part of the Northeastern coast of Brazil, contained in UTM zone 24, block M.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mgrs"></span>
<img src="images/s2_mgrs_grid.png" alt="MGRS tiling system used by Sentinel-2 images (Source: GISSurfer 2.0. Reproduction based on fair use doctrine)." width="80%"><p class="caption">
Figure 10: MGRS tiling system used by Sentinel-2 images (Source: GISSurfer 2.0. Reproduction based on fair use doctrine).
</p>
</div>
<p>The Landsat-4/5/7/8/9 satellites use the Worldwide Reference System (WRS-2), which breaks the coverage of Landsat satellites into images identified by path and row (see Figure <a href="earth-observation-data-cubes.html#fig:wrs">11</a>). The path is the descending orbit of the satellite; the WRS-2 system has 233 paths per orbit, and each path has 119 rows, where each row refers to a latitudinal center line of a frame of imagery. Images in WRS-2 are geometrically corrected to the UTM projection.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:wrs"></span>
<img src="images/landsat_wrs_grid.png" alt="WRS-2 tiling system used by Landsat-5/7/8/9 images (Source: INPE and ESRI. Reproduction based on fair use doctrine)." width="80%"><p class="caption">
Figure 11: WRS-2 tiling system used by Landsat-5/7/8/9 images (Source: INPE and ESRI. Reproduction based on fair use doctrine).
</p>
</div>
</div>
<div id="ard-image-collections-handled-by-sits" class="section level2 unnumbered">
<h2>ARD image collections handled by sits<a class="anchor" aria-label="anchor" href="#ard-image-collections-handled-by-sits"><i class="fas fa-link"></i></a>
</h2>
<p>Package <code>sits</code> supports access to the following ARD image collections:</p>
<ol style="list-style-type: decimal">
<li>Amazon Web Services (AWS): Open data Sentinel-2/2A level 2A collections for the Earth’s land surface.</li>
<li>Brazil Data Cube (BDC): Open data collections of Sentinel-2/2A, Landsat-8, CBERS-4/4A, and MODIS images for Brazil. These collections are organized as regular data cubes.</li>
<li>Digital Earth Africa (DEAFRICA): Open data collections of Sentinel-2/2A and Landsat-8 for Africa.</li>
<li>Microsoft Planetary Computer (MPC): Open data collections of Sentinel-2/2A and Landsat-4/5/7/8/9 for the Earth’s land areas.</li>
<li>USGS: Landsat-4/5/7/8/9 collections available in AWS, which require access payment.</li>
<li>Swiss Data Cube (SDC): Open data collection of Sentinel-2/2A and Landsat-8 images for Switzerland.</li>
<li>Harmonized Landsat-Sentinel (HLS): HLS, provided by NASA, is a collection that processes Landsat 8 and Sentinel-2 imagery to a common standard.</li>
</ol>
</div>
<div id="regular-image-data-cubes" class="section level2 unnumbered">
<h2>Regular image data cubes<a class="anchor" aria-label="anchor" href="#regular-image-data-cubes"><i class="fas fa-link"></i></a>
</h2>
<p>Machine learning and deep learning (ML/DL) classification algorithms require the input data to be consistent. The dimensionality of the data used for training the model has to be the same as that of the data to be classified. There should be no gaps and no missing values. Thus, to use ML/DL algorithms for remote sensing data, ARD image collections should be converted to regular data cubes. Adapting a previous definition by Appel and Pebesma <span class="citation"><a href="references.html#ref-Appel2019">[4]</a></span>, we consider a <em>regular data cube</em> has the following definition and properties:</p>
<ol style="list-style-type: decimal">
<li>A regular data cube is a four-dimensional structure with dimensions x (longitude or easting), y (latitude or northing), time, and bands. The spatial, temporal, and attribute dimensions are independent and not interchangeable.</li>
<li>The spatial dimensions refer to a coordinate system, such as the grids defined by UTM (Universal Transverse Mercator) or MGRS (Military Grid Reference System). A grid (or tile) of the grid corresponds to a unique zone of the coordinate system.</li>
<li>The temporal dimension is a set of continuous and equally-spaced intervals.</li>
<li>For every combination of dimensions, a cell has a single value.</li>
</ol>
<p>All cells of a data cube have the same spatiotemporal extent. The spatial resolution of each cell is the same in X and Y dimensions. All temporal intervals are the same. Each cell contains a valid set of measures. Each pixel is associated to a unique coordinate in a zone of the coordinate system. For each position in space, the data cube should provide a set of valid time series. For each time interval, the regular data cube should provide a valid 2D image (see Figure <a href="earth-observation-data-cubes.html#fig:dc">12</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dc"></span>
<img src="images/datacube_conception.png" alt="Conceptual view of data cubes (Source: Authors)." width="100%"><p class="caption">
Figure 12: Conceptual view of data cubes (Source: Authors).
</p>
</div>
<p>Currently, the only cloud service that provides regular data cubes by default is the Brazil Data Cube (BDC). ARD collections available in AWS, MPC, USGS, and DEAFRICA are not regular in space and time. Bands may have different resolutions, images may not cover the entire time, and time intervals may be irregular. For this reason, subsets of these collections need to be converted to regular data cubes before further processing. To produce data cubes for machine-learning data analysis, users should first create an irregular data cube from an ARD collection and then use <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code>, as described below.</p>
</div>
<div id="creating-data-cubes" class="section level2 unnumbered">
<h2>Creating data cubes<a class="anchor" aria-label="anchor" href="#creating-data-cubes"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://www.kaggle.com/esensing/creating-data-cubes-in-sits" target="_blank"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a></p>
<p>To obtain information on ARD image collection from cloud providers, <code>sits</code> uses the <a href="https://stacspec.org/en">SpatioTemporal Asset Catalogue</a> (STAC) protocol, a specification of geospatial information which many large image collection providers have adopted. A ‘spatiotemporal asset’ is any file that represents information about the Earth captured in a specific space and time. To access STAC endpoints, <code>sits</code> uses the <a href="http://github.com/brazil-data-cube/rstac">rstac</a> R package.</p>
<p>The function <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> supports access to image collections in cloud services; it has the following parameters:</p>
<ol style="list-style-type: decimal">
<li>
<code>source</code>: Name of the provider.</li>
<li>
<code>collection</code>: A collection available in the provider and supported by <code>sits</code>. To find out which collections are supported by <code>sits</code>, see <code><a href="https://rdrr.io/pkg/sits/man/sits_list_collections.html">sits_list_collections()</a></code>.</li>
<li>
<code>platform</code>: Optional parameter specifying the platform in collections with multiple satellites.</li>
<li>
<code>tiles</code>: Set of tiles of image collection reference system. Either <code>tiles</code> or <code>roi</code> should be specified.</li>
<li>
<code>roi</code>: A region of interest. Either: (a) a named vector (<code>lon_min</code>, <code>lon_max</code>, <code>lat_min</code>, <code>lat_max</code>) in WGS 84 coordinates; or (b) an <code>sf</code> object. All images intersecting the convex hull of the <code>roi</code> are selected.</li>
<li>
<code>bands</code>: Optional parameter with the bands to be used. If missing, all bands from the collection are used.</li>
<li>
<code>start_date</code>: The initial date for the temporal interval containing the time series of images.</li>
<li>
<code>end_date</code>: The final date for the temporal interval containing the time series of images.</li>
</ol>
<p>The result of <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> is a tibble with a description of the selected images required for further processing. It does not contain the actual data, but only pointers to the images. The attributes of individual image files can be assessed by listing the <code>file_info</code> column of the tibble.</p>
</div>
<div id="assessing-amazon-web-services" class="section level2 unnumbered">
<h2>Assessing Amazon Web Services<a class="anchor" aria-label="anchor" href="#assessing-amazon-web-services"><i class="fas fa-link"></i></a>
</h2>
<p>Amazon Web Services (AWS) holds two kinds of collections: <em>open-data</em> and <em>requester-pays</em>. Open data collections can be accessed without cost. Requester-pays collections require payment from an AWS account. Currently, <code>sits</code> supports collection <code>SENTINEL-2-L2A</code> which is open data. The bands in 10 m resolution are B02, B03, B04, and B08. The 20 m bands are B05, B06, B07, B8A, B11, and B12. Bands B01 and B09 are available at 60 m resolution. A CLOUD band is also available. The example below shows how to access one tile of the open data <code>SENTINEL-2-L2A</code> collection. The <code>tiles</code> parameter allows selecting the desired area according to the MGRS reference system.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data cube covering an area in Brazil</span></span>
<span><span class="va">s2_23MMU_cube</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"AWS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"23MMU"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2018-07-12"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-07-28"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_23MMU_cube</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B11"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"B02"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"B8A"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2018-10-05"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-27"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-27-1.png" alt="Sentinel-2 image in an area of the Northeastern coast of Brazil." width="100%"><p class="caption">
Figure 13: Sentinel-2 image in an area of the Northeastern coast of Brazil.
</p>
</div>
</div>
<div id="assessing-microsofts-planetary-computer" class="section level2 unnumbered">
<h2>Assessing Microsoft’s Planetary Computer<a class="anchor" aria-label="anchor" href="#assessing-microsofts-planetary-computer"><i class="fas fa-link"></i></a>
</h2>
<p>Microsoft’s Planetary Computer (MPC) hosts two open data collections: <code>SENTINEL-2-L2A</code> and <code>LANDSAT-C2-L2</code>. The first collection contains SENTINEL-2/2A ARD images, with the same bands and resolutions as those available in AWS (see above). The example below shows how to access the <code>SENTINEL-2-L2A</code> collection.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data cube covering an area in the Brazilian Amazon</span></span>
<span><span class="va">s2_20LKP_cube_MPC</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"20LKP"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2019-07-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-07-28"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot a color composite of one date of the cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_20LKP_cube_MPC</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B11"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2019-07-18"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-28"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-28-1.png" alt="Sentinel-2 image in an area of the state of Rondonia, Brazil (Source: Authors)." width="100%"><p class="caption">
Figure 14: Sentinel-2 image in an area of the state of Rondonia, Brazil (Source: Authors).
</p>
</div>
<p>The <code>LANDSAT-C2-L2</code> collection provides access to data from Landsat-4/5/7/8/9 satellites. Images from these satellites have been intercalibrated to ensure data consistency. For compatibility between the different Landsat sensors, the band names are BLUE, GREEN, RED, NIR08, SWIR16, and SWIR22. All images have 30 m resolution. For this collection, tile search is not supported; the <code>roi</code> parameter should be used. The example below shows how to retrieve data from a region of interest covering the city of Brasilia in Brazil.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a ROI that covers part of the Northeastern coast of Brazil</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  lon_min <span class="op">=</span> <span class="op">-</span><span class="fl">43.5526</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">2.9644</span>,</span>
<span>  lon_max <span class="op">=</span> <span class="op">-</span><span class="fl">42.5124</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">2.1671</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Select the cube</span></span>
<span><span class="va">s2_L8_cube_MPC</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"LANDSAT-C2-L2"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"RED"</span>, <span class="st">"GREEN"</span>, <span class="st">"NIR08"</span>, <span class="st">"SWIR16"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">roi</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2019-06-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-09-01"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the tile that covers the Lencois Maranhenses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_L8_cube_MPC</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"RED"</span>, green <span class="op">=</span> <span class="st">"GREEN"</span>, blue <span class="op">=</span> <span class="st">"BLUE"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2019-06-30"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-29"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-29-1.png" alt="Landsat-8 image in an area in Northeast Brazil (Source: Authors)." width="100%"><p class="caption">
Figure 15: Landsat-8 image in an area in Northeast Brazil (Source: Authors).
</p>
</div>
</div>
<div id="assessing-digital-earth-africa" class="section level2 unnumbered">
<h2>Assessing Digital Earth Africa<a class="anchor" aria-label="anchor" href="#assessing-digital-earth-africa"><i class="fas fa-link"></i></a>
</h2>
<p>Digital Earth Africa (DEAFRICA) is a cloud service that provides open-access Earth observation data for the African continent. The ARD image collections in <code>sits</code> are <code>S2_L2A</code> (Sentinel-2 level 2A) and <code>LS8_SR</code> (Landsat-8). Since the STAC interface for DEAFRICA does not implement the concept of tiles, users need to specify their area of interest using the <code>roi</code> parameter. The requested <code>roi</code> produces a cube that contains one MGRS tiles (“35LPH”) covering an area of Madagascar that includes the Betsiboka Estuary.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dea_s2_cube</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"DEAFRICA"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"S2_L2A"</span>,</span>
<span>  roi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    lon_min <span class="op">=</span> <span class="fl">46.1</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">15.6</span>,</span>
<span>    lon_max <span class="op">=</span> <span class="fl">46.6</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">16.1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"B02"</span>, <span class="st">"B03"</span>, <span class="st">"B04"</span>,</span>
<span>    <span class="st">"B05"</span>, <span class="st">"B06"</span>, <span class="st">"B07"</span>,</span>
<span>    <span class="st">"B08"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>,</span>
<span>    <span class="st">"B12"</span>, <span class="st">"CLOUD"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2019-04-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-11-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dea_s2_cube</span>, red <span class="op">=</span> <span class="st">"B04"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>, green <span class="op">=</span> <span class="st">"B08"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-30"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-30-1.png" alt="Sentinel-2 image in an area over Madagascar." width="100%"><p class="caption">
Figure 16: Sentinel-2 image in an area over Madagascar.
</p>
</div>
</div>
<div id="assessing-the-brazil-data-cube" class="section level2 unnumbered">
<h2>Assessing the Brazil Data Cube<a class="anchor" aria-label="anchor" href="#assessing-the-brazil-data-cube"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://brazildatacube.org/en">Brazil Data Cube</a> (BDC) is built by Brazil’s National Institute for Space Research (INPE), to provide regular EO data cubes from CBERS, LANDSAT, SENTINEL-2, and TERRA/MODIS satellites for environmental applications. The collections available in the BDC are: <code>LANDSAT-OLI-16D</code> (Landsat-8 OLI, 30 m resolution, 16-day intervals), <code>SENTINEL-2-16D</code> (Sentinel-2A and 2B MSI images at 10 m resolution, 16-day intervals), <code>CBERS-WFI-16D</code> (CBERS 4 WFI, 64 m resolution, 16-day intervals), <code>CBERS-WFI-8D</code>(CBERS 4 and 4A WFI images, 64m resolution, 8-day intervals) <code>CBERS-MUX-2M</code> (CBERS 4/4A MUX, 20 m resolution, two-month intervals), and <code>MOD13Q1-6</code> (MODIS MOD13SQ1 product, collection 6, 250 m resolution, 16-day intervals). For more details, use <code>sits_list_collections(source = "BDC")</code>.</p>
<p>The BDC uses three hierarchical grids based on the Albers Equal Area projection and SIRGAS 2000 datum. The large grid has tiles of 4224.4 <span class="math inline">\(\times4\)</span> 224.4 km<sup>2</sup> and is used for CBERS-4 AWFI collections at 64 m resolution; each CBERS-4 AWFI tile contains images of 6600 <span class="math inline">\(\times\)</span> 6600 pixels. The medium grid is used for Landsat-8 OLI collections at 30 m resolution; tiles have an extension of 211.2 <span class="math inline">\(\times\)</span> 211.2 km<sup>2</sup>, and each image has 7040 <span class="math inline">\(\times\)</span> 7040 pixels. The small grid covers 105.6 <span class="math inline">\(\times\)</span> 105.6 km<sup>2</sup> and is used for Sentinel-2 MSI collections at 10 m resolutions; each image has 10560 <span class="math inline">\(\times\)</span> 10560 pixels. The data cubes in the BDC are regularly spaced in time and cloud-corrected <span class="citation"><a href="references.html#ref-Ferreira2020a">[5]</a></span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-31"></span>
<img src="images/bdc_grid.png" alt="Hierarchical BDC tiling system showing (a) large BDC grid overlayed on Brazilian biomes, (b) one large tile, (c) four medium tiles, and (d) sixteen small tiles (Source: Ferreira et al. (2020). Reproduction under fair use doctrine)." width="80%"><p class="caption">
Figure 17: Hierarchical BDC tiling system showing (a) large BDC grid overlayed on Brazilian biomes, (b) one large tile, (c) four medium tiles, and (d) sixteen small tiles (Source: Ferreira et al. (2020). Reproduction under fair use doctrine).
</p>
</div>
<p>To access the BDC, users must provide their credentials using environment variables, as shown below. Obtaining a BDC access key is free. Users must register at the <a href="https://brazildatacube.dpi.inpe.br/portal/explore">BDC site</a> to obtain the key.</p>
<p>In the example below, the data cube is defined as one tile (“005004”) of <code>CBERS-WFI-16D</code> collection, which holds CBERS AWFI images at 16 days resolution.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a tile from the CBERS-4/4A AWFI collection</span></span>
<span><span class="va">cbers_tile</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"BDC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"CBERS-WFI-16D"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"005004"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B13"</span>, <span class="st">"B14"</span>, <span class="st">"B15"</span>, <span class="st">"B16"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-05-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-09-01"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot one time instance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cbers_tile</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B15"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"B16"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"B13"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2021-05-09"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-32"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-32-1.png" alt="CBERS-4 WFI image in a Cerrado area in Brazil." width="100%"><p class="caption">
Figure 18: CBERS-4 WFI image in a Cerrado area in Brazil.
</p>
</div>
</div>
<div id="accessing-harmonized-landsat-sentinel-collections" class="section level2 unnumbered">
<h2>Accessing Harmonized Landsat-Sentinel collections<a class="anchor" aria-label="anchor" href="#accessing-harmonized-landsat-sentinel-collections"><i class="fas fa-link"></i></a>
</h2>
<p>Harmonized Landsat Sentinel (HLS) is a NASA initiative that processes and harmonizes Landsat 8 and Sentinel-2 imagery to a common standard, including atmospheric correction, alignment, resampling, and corrections for BRDF (bidirectional reflectance distribution function). The purpose of the HLS project is to create a unified and consistent dataset that integrates the advantages of both systems, making it easier for users to work with the data.</p>
<p>The NASA Harmonized Landsat and Sentinel (HLS) service provides two image collections:</p>
<ol style="list-style-type: decimal">
<li><p>Landsat 8 OLI Surface Reflectance HLS (HLSL30) – The HLSL30 product includes atmospherically corrected surface reflectance from the Landsat 8 OLI sensors at 30 m resolution. The dataset includes 11 spectral bands.</p></li>
<li><p>Sentinel-2 MultiSpectral Instrument Surface Reflectance HLS (HLSS30) – The HLSS30 product includes atmospherically corrected surface reflectance from the Sentinel-2 MSI sensors at 30 m resolution. The dataset includes 12 spectral bands.</p></li>
</ol>
<p>The HLS tiling system is identical as the one used for Sentinel-2 (MGRS). The tiles dimension is 109.8 km and there is an overlap of 4,900 m on each side.</p>
<p>To access NASA HLS, users need to registed at <a href="https://urs.earthdata.nasa.gov/">NASA EarthData</a>, and save their login and password in a ~/.netrc plain text file in Unix (or %HOME%_netrc in Windows). The file must contain the following fields:</p>
<pre class="echo"><code>machine urs.earthdata.nasa.gov
login &lt;username&gt;
password &lt;password&gt;</code></pre>
<p>Access to images in NASA HLS is done by region of interest. The following example shows an HLS Sentinel-2 image over the Brazilian coast.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a region of interest</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  lon_min <span class="op">=</span> <span class="op">-</span><span class="fl">45.6422</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">24.0335</span>,</span>
<span>  lon_max <span class="op">=</span> <span class="op">-</span><span class="fl">45.0840</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">23.6178</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a cube from the HLSS30 collection</span></span>
<span><span class="va">hls_cube_s2</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"HLS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"HLSS30"</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">roi</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"GREEN"</span>, <span class="st">"RED"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-09-01"</span><span class="op">)</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot the cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hls_cube_s2</span>, red <span class="op">=</span> <span class="st">"RED"</span>, green <span class="op">=</span> <span class="st">"GREEN"</span>, blue <span class="op">=</span> <span class="st">"BLUE"</span>, date <span class="op">=</span> <span class="st">"2020-06-20"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="images/hls_ilhabela_s2.png" alt="Plot of Sentinel-2 image obtained from the NASA HLS collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast." width="100%"><p class="caption">
Figure 19: Plot of Sentinel-2 image obtained from the NASA HLS collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast.
</p>
</div>
<p>Images from the HLS Landsat and Sentinel-2 collections are accessed separately and can be combined with <code><a href="https://rdrr.io/pkg/sits/man/sits_merge.html">sits_merge()</a></code>. The script below creates an HLS Landsat cube over the same area as the Sentinel-2 cube above bands. The two cubes are then merged.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a region of interest</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  lon_min <span class="op">=</span> <span class="op">-</span><span class="fl">45.6422</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">24.0335</span>,</span>
<span>  lon_max <span class="op">=</span> <span class="op">-</span><span class="fl">45.0840</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">23.6178</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a cube from the HLSS30 collection</span></span>
<span><span class="va">hls_cube_l8</span> <span class="op">&lt;-</span> <span class="fu">sits_cube</span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"HLS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"HLSL30"</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">roi</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"GREEN"</span>, <span class="st">"RED"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-09-01"</span><span class="op">)</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># merge the Sentinel-2 and Landsat-8 cubes</span></span>
<span><span class="va">hls_cube_merged</span> <span class="op">&lt;-</span> <span class="fu">sits_merge</span><span class="op">(</span><span class="va">hls_cube_s2</span>, <span class="va">hls_cube_l8</span><span class="op">)</span></span></code></pre></div>
<p>Comparing the timelines of the original cubes and the merged one, one can see the benefits of the merged collection for time series data analysis.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeline of the Sentinel-2 cube</span></span>
<span><span class="fu">sits_timeline</span><span class="op">(</span><span class="va">hls_cube_s2</span><span class="op">)</span></span></code></pre></div>
<pre class="sourceCode"><code>#&gt;  [1] "2020-06-15" "2020-06-20" "2020-06-25" "2020-06-30" "2020-07-05" "2020-07-10" "2020-07-20"
#&gt;  [8] "2020-07-25" "2020-08-04" "2020-08-09" "2020-08-14" "2020-08-19" "2020-08-24" "2020-08-29"</code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeline of the Landsat-8 cube</span></span>
<span><span class="fu">sits_timeline</span><span class="op">(</span><span class="va">hls_cube_l8</span><span class="op">)</span></span></code></pre></div>
<pre class="sourceCode"><code>#&gt; [1] "2020-06-09" "2020-06-25" "2020-07-11" "2020-07-27" "2020-08-12" "2020-08-28"</code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeline of the Landsat-8 cube</span></span>
<span><span class="fu">sits_timeline</span><span class="op">(</span><span class="va">hls_cube_merged</span><span class="op">)</span></span></code></pre></div>
<pre class="sourceCode"><code>#&gt;  [1] "2020-06-09" "2020-06-15" "2020-06-20" "2020-06-25" "2020-06-30" "2020-07-05" "2020-07-10"
#&gt;  [8] "2020-07-11" "2020-07-20" "2020-07-25" "2020-07-27" "2020-08-04" "2020-08-09" "2020-08-12"
#&gt; [15] "2020-08-14" "2020-08-19" "2020-08-24" "2020-08-28" "2020-08-29"</code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotting a harmonized Landsat image from the merged dataset</span></span>
<span><span class="co"># plot the cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hls_cube_merged</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"RED"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"GREEN"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"BLUE"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2020-07-11"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-41"></span>
<img src="images/hls_ilhabela_l8.png" alt="Plot of Sentinel-2 image obtained from the NASA HLS collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast." width="100%"><p class="caption">
Figure 20: Plot of Sentinel-2 image obtained from the NASA HLS collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast.
</p>
</div>
</div>
<div id="defining-a-data-cube-using-ard-local-files" class="section level2 unnumbered">
<h2>Defining a data cube using ARD local files<a class="anchor" aria-label="anchor" href="#defining-a-data-cube-using-ard-local-files"><i class="fas fa-link"></i></a>
</h2>
<p>ARD images downloaded from cloud collections to a local computer are not associated with a STAC endpoint that describes them. They must be organized and named to allow <code>sits</code> to create a data cube from them. All local files have to be in the same directory and have the same spatial resolution and projection. Each file must contain a single image band for a single date. Each file name needs to include tile, date, and band information. Users must provide information about the original data source to allow <code>sits</code> to retrieve information about image attributes such as band names, missing values, etc. When working with local cubes, <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> needs the following parameters:</p>
<ol style="list-style-type: decimal">
<li>
<code>source</code>: Name of the original data provider; for a list of providers and collections, use <code><a href="https://rdrr.io/pkg/sits/man/sits_list_collections.html">sits_list_collections()</a></code>.</li>
<li>
<code>collection</code>: Collection from where the data was extracted.</li>
<li>
<code>data_dir</code>: Local directory for images.</li>
<li>
<code>bands</code>: Optional parameter to describe the bands to be retrieved.</li>
<li>
<code>parse_info</code>: Information to parse the file names. File names need to contain information on tile, date, and band, separated by a delimiter (usually <code>"_"</code>).</li>
<li>
<code>delim</code>: Separator character between descriptors in the file name (default is <code>"_"</code>).</li>
</ol>
<p>The example shows how to define a data cube using files from the <code>sitsdata</code> package. The dataset contains part of tile “20LMR” of Sentinel-2 images for the period 2022-01-05 to 2021-08-26, with bands B02, B8A, and B11. Data is extracted from collection “SENTINEL-2-L2A” on Microsoft Planetary Computer (“MPC”).</p>
<p>In general, <code>sits</code> users need to match the local file names to the values provided by the <code>parse_info</code> parameter. Since the file names of this dataset use the format <code>SENTINEL-2_MSI_20LMR_B8A_2022-12-23.tif</code>, which fits the default value for <code>parse_info</code> which is <code>c("X1", "X2", "tile", "band", "date")</code> and for <code>delim</code> which is “_“, it is not necessary to set these values when creating a data cube from the local files.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-sensing/sits/">sits</a></span><span class="op">)</span></span>
<span><span class="co"># Create a cube based on a stack of CBERS data</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Rondonia-20LKP"</span>, package <span class="op">=</span> <span class="st">"sitsdata"</span><span class="op">)</span></span>
<span><span class="co"># List the first file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<pre class="sourceCode"><code>#&gt; [1] "SENTINEL-2_MSI_20LKP_B02_2020-06-04.tif"</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data cube from local files</span></span>
<span><span class="va">s2_cube_20LKP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the band B8A in the first time instance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_cube_20LKP</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B11"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2020-07-22"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-43"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-43-1.png" alt="Sentinel-2 image over an area in Rondonia, Brazil (Source: Authors)." width="100%"><p class="caption">
Figure 21: Sentinel-2 image over an area in Rondonia, Brazil (Source: Authors).
</p>
</div>
</div>
<div id="defining-a-data-cube-using-classified-images" class="section level2 unnumbered">
<h2>Defining a data cube using classified images<a class="anchor" aria-label="anchor" href="#defining-a-data-cube-using-classified-images"><i class="fas fa-link"></i></a>
</h2>
<p>It is also possible to create local cubes based on results that have been produced by classification or post-classification algorithms. In this case, more parameters are required, and the parameter <code>parse_info</code> is specified differently, as follows:</p>
<ol style="list-style-type: decimal">
<li>
<code>source</code>: Name of the original data provider.</li>
<li>
<code>collection</code>: Name of the collection from where the data was extracted.</li>
<li>
<code>data_dir</code>: Local directory for the classified images.</li>
<li>
<code>band</code>: Band name associated with the type of result. Use: (a) <code>probs</code> for probability cubes produced by <code><a href="https://rdrr.io/pkg/sits/man/sits_classify.html">sits_classify()</a></code>; (b) <code>bayes</code>, for cubes produced by <code><a href="https://rdrr.io/pkg/sits/man/sits_smooth.html">sits_smooth()</a></code>; (c) <code>entropy</code>, <code>least</code>, <code>ratio</code> or <code>margin</code>, according to the method selected when using <code><a href="https://rdrr.io/pkg/sits/man/sits_uncertainty.html">sits_uncertainty()</a></code>; and (d) <code>class</code> for classified cubes.</li>
<li>
<code>labels</code>: Labels associated with the names of the classes (not required for cubes produced by <code><a href="https://rdrr.io/pkg/sits/man/sits_uncertainty.html">sits_uncertainty()</a></code>).</li>
<li>
<code>version</code>: Version of the result (default = <code>v1</code>).</li>
<li>
<code>parse_info</code>: File name parsing information to allow <code>sits</code> to deduce the values of <code>tile</code>, <code>start_date</code>, <code>end_date</code>, <code>band</code>, and <code>version</code> from the file name. Unlike non-classified image files, cubes produced by classification and post-classification have both <code>start_date</code> and <code>end_date</code>.</li>
</ol>
<p>The following code creates a results cube based on the classification of deforestation in Brazil. This classified cube was obtained by a large data cube of Sentinel-2 images, covering the state of Rondonia, Brazil comprising 40 tiles, 10 spectral bands, and covering the period from 2020-06-01 to 2021-09-11. Samples of four classes were trained by a random forest classifier. Internally, classified images use integers to represent classes. Thus, labels have to be associated to the integers that represent each class name.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a cube based on a classified image</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Rondonia-20LLP"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sitsdata"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># File name  "SENTINEL-2_MSI_20LLP_2020-06-04_2021-08-26_class_v1.tif"</span></span>
<span><span class="va">Rondonia_class_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"AWS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-S2-L2A-COGS"</span>,</span>
<span>  bands <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Burned_Area"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Cleared_Area"</span>,</span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="st">"Highly_Degraded"</span>, <span class="st">"4"</span> <span class="op">=</span> <span class="st">"Forest"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>  parse_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"satellite"</span>, <span class="st">"sensor"</span>, <span class="st">"tile"</span>, <span class="st">"start_date"</span>, <span class="st">"end_date"</span>,</span>
<span>    <span class="st">"band"</span>, <span class="st">"version"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the classified cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Rondonia_class_cube</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-44"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-44-1.png" alt="Classified data cube for the year 2020/2021 in Rondonia, Brazil (Source: Authors)." width="100%"><p class="caption">
Figure 22: Classified data cube for the year 2020/2021 in Rondonia, Brazil (Source: Authors).
</p>
</div>
</div>
<div id="regularizing-data-cubes" class="section level2 unnumbered">
<h2>Regularizing data cubes<a class="anchor" aria-label="anchor" href="#regularizing-data-cubes"><i class="fas fa-link"></i></a>
</h2>
<p>ARD collections available in AWS, MPC, USGS, and DEAFRICA are not regular in space and time. Bands may have different resolutions, images may not cover the entire tile, and time intervals are irregular. For this reason, data from these collections need to be converted to regular data cubes by calling <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code>, which uses the <em>gdalcubes</em> package <span class="citation"><a href="references.html#ref-Appel2019">[4]</a></span>.</p>
<p>In the following example, the user has created an irregular data cube from the Sentinel-2 collection available in Microsoft’s Planetary Computer (MPC) for tiles <code>20LKP</code> and <code>20LLP</code> in the state of Rondonia, Brazil. We first build an irregular data cube using <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating an irregular data cube from MPC</span></span>
<span><span class="va">s2_cube_rondonia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"20LKP"</span>, <span class="st">"20LLP"</span><span class="op">)</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B05"</span>, <span class="st">"B8A"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-07-01"</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-08-31"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Show the different timelines of the cube tiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">s2_cube_rondonia</span><span class="op">)</span></span></code></pre></div>
<pre class="sourceCode"><code>#&gt; $`20LKP`
#&gt;  [1] "2018-07-03" "2018-07-08" "2018-07-13" "2018-07-18" "2018-07-23" "2018-07-28" "2018-08-02"
#&gt;  [8] "2018-08-07" "2018-08-12" "2018-08-17" "2018-08-22" "2018-08-27"
#&gt; 
#&gt; $`20LLP`
#&gt;  [1] "2018-07-03" "2018-07-05" "2018-07-08" "2018-07-10" "2018-07-13" "2018-07-15" "2018-07-18"
#&gt;  [8] "2018-07-20" "2018-07-23" "2018-07-25" "2018-07-28" "2018-07-30" "2018-08-02" "2018-08-04"
#&gt; [15] "2018-08-07" "2018-08-09" "2018-08-12" "2018-08-14" "2018-08-17" "2018-08-19" "2018-08-22"
#&gt; [22] "2018-08-24" "2018-08-27" "2018-08-29"</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the first image of the irregular cube</span></span>
<span><span class="va">s2_cube_rondonia</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tile</span> <span class="op">==</span> <span class="st">"20LLP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>red <span class="op">=</span> <span class="st">"B12"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B05"</span>, date <span class="op">=</span> <span class="st">"2018-07-03"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-46"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-46-1.png" alt="Sentinel-2 tile 20LLP for date 2018-07-03 (Source: Authors)." width="100%"><p class="caption">
Figure 23: Sentinel-2 tile 20LLP for date 2018-07-03 (Source: Authors).
</p>
</div>
<p>Because of the different acquisition orbits of the Sentinel-2 and Sentinel-2A satellites, the two tiles also have different timelines. Tile <code>20LKP</code> has 12 instances, while tile <code>20LLP</code> has 24 instances for the chosen period. The function <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> builds a data cube with a regular timeline and a best estimate of a valid pixel for each interval. The <code>period</code> parameter sets the time interval between two images. Values of <code>period</code> use the ISO8601 time period specification, which defines time intervals as <code>P[n]Y[n]M[n]D</code>, where “Y” stands for years, “M” for months, and “D” for days. Thus, <code>P1M</code> stands for a one-month period, <code>P15D</code> for a fifteen-day period. When joining different images to get the best image for a period, <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> uses an aggregation method that organizes the images for the chosen interval in order of increasing cloud cover and then selects the first cloud-free pixel.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regularize the cube to 15 day intervals</span></span>
<span><span class="va">reg_cube_rondonia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>  cube       <span class="op">=</span> <span class="va">s2_cube_rondonia</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4"</span>,</span>
<span>  res        <span class="op">=</span> <span class="fl">120</span>,</span>
<span>  period     <span class="op">=</span> <span class="st">"P15D"</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the first image of the tile 20LLP of the regularized cube</span></span>
<span><span class="co"># The pixels of the regular data cube cover the full MGRS tile</span></span>
<span><span class="va">reg_cube_rondonia</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tile</span> <span class="op">==</span> <span class="st">"20LLP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>red <span class="op">=</span> <span class="st">"B12"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B05"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-47"></span>
<img src="sitsbook_files/figure-html/unnamed-chunk-47-1.png" alt="Regularized image for tile Sentinel-2 tile 20LLP (Source: Authors)." width="100%"><p class="caption">
Figure 24: Regularized image for tile Sentinel-2 tile 20LLP (Source: Authors).
</p>
</div>
<p>After obtaining a regular data cube, users can perform data analysis and classification operations, as shown in the following chapters.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction.html">Introduction</a></div>
<div class="next"><a href="operations-on-data-cubes.html">Operations on data cubes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#earth-observation-data-cubes">Earth observation data cubes</a></li>
<li><a class="nav-link" href="#analysis-ready-data-image-collections">Analysis-ready data image collections</a></li>
<li><a class="nav-link" href="#ard-image-collections-handled-by-sits">ARD image collections handled by sits</a></li>
<li><a class="nav-link" href="#regular-image-data-cubes">Regular image data cubes</a></li>
<li><a class="nav-link" href="#creating-data-cubes">Creating data cubes</a></li>
<li><a class="nav-link" href="#assessing-amazon-web-services">Assessing Amazon Web Services</a></li>
<li><a class="nav-link" href="#assessing-microsofts-planetary-computer">Assessing Microsoft’s Planetary Computer</a></li>
<li><a class="nav-link" href="#assessing-digital-earth-africa">Assessing Digital Earth Africa</a></li>
<li><a class="nav-link" href="#assessing-the-brazil-data-cube">Assessing the Brazil Data Cube</a></li>
<li><a class="nav-link" href="#accessing-harmonized-landsat-sentinel-collections">Accessing Harmonized Landsat-Sentinel collections</a></li>
<li><a class="nav-link" href="#defining-a-data-cube-using-ard-local-files">Defining a data cube using ARD local files</a></li>
<li><a class="nav-link" href="#defining-a-data-cube-using-classified-images">Defining a data cube using classified images</a></li>
<li><a class="nav-link" href="#regularizing-data-cubes">Regularizing data cubes</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</strong>" was written by Gilberto Camara, Rolf Simoes, Felipe Souza, Charlotte Pelletier, Alber Sanchez, Pedro R. Andrade, Karine Ferreira, Gilberto Queiroz. It was last built on 2023-12-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
