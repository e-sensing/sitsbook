<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes</title>
<meta name="author" content="Gilberto Camara">
<meta name="author" content="Rolf Simoes">
<meta name="author" content="Felipe Souza">
<meta name="author" content="Felipe Menino">
<meta name="author" content="Charlotte Pelletier">
<meta name="author" content="Pedro R. Andrade">
<meta name="author" content="Karine Ferreira">
<meta name="author" content="Gilberto Queiroz">
<meta name="description" content="Who is this book for? This book is intended for land use change experts and researchers, allowing them to harness the power of big Earth observation data sets. We aim to provide readers with the...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Introduction | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover_sits_book.png">
<meta property="og:description" content="Who is this book for? This book is intended for land use change experts and researchers, allowing them to harness the power of big Earth observation data sets. We aim to provide readers with the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Introduction | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta name="twitter:description" content="Who is this book for? This book is intended for land use change experts and researchers, allowing them to harness the power of big Earth observation data sets. We aim to provide readers with the...">
<meta name="twitter:image" content="/images/cover_sits_book.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/IBM_Plex_Serif-0.4.9/font.css" rel="stylesheet">
<link href="libs/IBM_Plex_Mono-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="setup.html">Setup</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
<li><a class="active" href="introduction.html">Introduction</a></li>
<li><a class="" href="earth-observation-data-cubes.html">Earth observation data cubes</a></li>
<li><a class="" href="operations-on-data-cubes.html">Operations on data cubes</a></li>
<li><a class="" href="working-with-time-series.html">Working with time series</a></li>
<li><a class="" href="improving-the-quality-of-training-samples.html">Improving the quality of training samples</a></li>
<li><a class="" href="machine-learning-for-data-cubes.html">Machine learning for data cubes</a></li>
<li><a class="" href="classification-of-raster-data-cubes.html">Classification of raster data cubes</a></li>
<li><a class="" href="bayesian-smoothing-for-post-processing.html">Bayesian smoothing for post-processing</a></li>
<li><a class="" href="validation-and-accuracy-measurements.html">Validation and accuracy measurements</a></li>
<li><a class="" href="uncertainty-and-active-learning.html">Uncertainty and active learning</a></li>
<li><a class="" href="ensemble-prediction-from-multiple-models.html">Ensemble prediction from multiple models</a></li>
<li><a class="" href="object-based-time-series-image-analysis.html">Object-based time series image analysis</a></li>
<li><a class="" href="technical-annex.html">Technical annex</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduction" class="section level1 unnumbered">
<h1>Introduction<a class="anchor" aria-label="anchor" href="#introduction"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://www.kaggle.com/esensing/introduction-to-sits" target="_blank"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a></p>
<div id="who-is-this-book-for" class="section level2 unnumbered">
<h2>Who is this book for?<a class="anchor" aria-label="anchor" href="#who-is-this-book-for"><i class="fas fa-link"></i></a>
</h2>
<p>This book is intended for land use change experts and researchers, allowing them to harness the power of big Earth observation data sets. We aim to provide readers with the means to produce high-quality maps of land use and land cover, guiding them through all necessary steps to achieve good results. Given the natural world’s complexity and huge variations in human-nature interactions, we consider that only local experts who know their countries and their ecosystems can extract full information from big EO data.</p>
<p>One group of readers that we are particularly keen to engage with are the national authorities on forest, agriculture, and statistics in developing countries. We aim to foster a collaborative environment where they can use EO data to enhance their national land use and cover estimates, thereby supporting sustainable development policies. To achieve this goal, <code>sits</code> has strong backing from the FAO Expert Group on the Use of Earth Observation data (FAO-EOSTAT)[<a href="https://www.fao.org/in-action/eostat" class="uri">https://www.fao.org/in-action/eostat</a>]. FAO-EOSTAT is at the forefront of using advanced EO data analysis methods for agricultural statistics in developing countries [<span class="citation"><a href="references.html#ref-DeSimone2022">[1]</a></span>]<span class="citation"><a href="references.html#ref-DeSimone2022a">[2]</a></span>.</p>
</div>
<div id="why-work-with-satellite-image-time-series" class="section level2 unnumbered">
<h2>Why work with satellite image time series?<a class="anchor" aria-label="anchor" href="#why-work-with-satellite-image-time-series"><i class="fas fa-link"></i></a>
</h2>
<p>Satellite images are the most comprehensive source of data about our environment. Covering a large area of the Earth’s surface, images allow researchers to study regional and global changes. Sensors capture data in multiple spectral bands to measure the physical, chemical, and biological properties of the Earth’s surface. By observing the same location multiple times, satellites provide data on changes in the environment and survey areas that are difficult to observe from the ground. Given its unique features, images offer essential information for many applications, including deforestation, crop production, food security, urban footprints, water scarcity, and land degradation.</p>
<p>A time series is a set of data points collected at regular intervals over time. Time series data is used to analyze trends, patterns, and changes. Satellite image time series refer to time series obtained from a collection of images captured by a satellite over a period of time, typically months or years. Using time series, experts improve their understanding of ecological patterns and processes. Instead of selecting individual images from specific dates and comparing them, researchers track change continuously <span class="citation"><a href="references.html#ref-Woodcock2020">[3]</a></span>.</p>
</div>
<div id="time-first-space-later" class="section level2 unnumbered">
<h2>Time-first, space-later<a class="anchor" aria-label="anchor" href="#time-first-space-later"><i class="fas fa-link"></i></a>
</h2>
<p>“Time-first, space-later” is a concept in satellite image classification that takes time series analysis as the first step for analyzing remote sensing data, with spatial information being considered after all time series are classified. The <em>time-first</em> part brings a better understanding of changes in landscapes. Detecting and tracking seasonal and long-term trends becomes feasible, as well as identifying anomalous events or patterns in the data, such as wildfires, floods, or droughts. Each pixel in a data cube is treated as a time series, using information available in the temporal instances of the case. Time series classification is pixel-based, producing a set of labeled pixels. This result is then used as input to the <em>space-later</em> part of the method. In this phase, a smoothing algorithm improves the results of time-first classification by considering the spatial neighborhood of each pixel. The resulting map thus combines both spatial and temporal information.</p>
</div>
<div id="how-sits-works" class="section level2 unnumbered">
<h2>How <code>sits</code> works<a class="anchor" aria-label="anchor" href="#how-sits-works"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>sits</code> package uses satellite image time series for land classification, using a <em>time-first, space-later</em> approach. In the data preparation part, collections of big Earth observation images are organized as data cubes. Each spatial location of a data cube is associated with a time series. Locations with known labels train a machine learning algorithm, which classifies all time series of a data cube, as shown in Figure <a href="introduction.html#fig:gview">1</a>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:gview"></span>
<img src="images/sits_general_view.png" alt="Using time series for land classification (source: authors)." width="70%" height="70%"><p class="caption">
Figure 1: Using time series for land classification (source: authors).
</p>
</div>
<p>The package provides tools for analysis, visualization, and classification of satellite image time series. Users follow a typical workflow for a pixel-based classification:</p>
<ol style="list-style-type: decimal">
<li>Select an analysis-ready data image collection from a cloud provider such as AWS, Microsoft Planetary Computer, Digital Earth Africa, or Brazil Data Cube.</li>
<li>Build a regular data cube using the chosen image collection.</li>
<li>Obtain new bands and indices with operations on data cubes.</li>
<li>Extract time series samples from the data cube to be used as training data.</li>
<li>Perform quality control and filtering on the time series samples.</li>
<li>Train a machine learning model using the time series samples.</li>
<li>Classify the data cube using the model to get class probabilities for each pixel.</li>
<li>Post-process the probability cube to remove outliers.</li>
<li>Produce a labeled map from the post-processed probability cube.</li>
<li>Evaluate the accuracy of the classification using best practices.</li>
</ol>
<p>Each workflow step corresponds to a function of the <code>sits</code> API, as shown in the Table below and Figure <a href="introduction.html#fig:api">2</a>. These functions have convenient default parameters and behaviors. A single function builds machine learning (ML) models. The classification function processes big data cubes with efficient parallel processing. Since the <code>sits</code> API is simple to learn, achieving good results do not require in-depth knowledge about machine learning and parallel processing.</p>
<div class="inline-table"><table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-2">Table 1: </span>The sits API workflow for land classification.
</caption>
<thead><tr>
<th style="text-align:left;">
API_function
</th>
<th style="text-align:left;">
Inputs
</th>
<th style="text-align:left;">
Output
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_cube()
</td>
<td style="text-align:left;">
ARD image collection
</td>
<td style="text-align:left;">
Irregular data cube
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_regularize()
</td>
<td style="text-align:left;">
Irregular data cube
</td>
<td style="text-align:left;">
Regular data cube
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_apply()
</td>
<td style="text-align:left;">
Regular data cube
</td>
<td style="text-align:left;">
Regular data cube with new bands and indices
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_get_data()
</td>
<td style="text-align:left;">
Data cube and sample locations
</td>
<td style="text-align:left;">
Time series
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_train()
</td>
<td style="text-align:left;">
Time series and ML method
</td>
<td style="text-align:left;">
ML classification model
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_classify()
</td>
<td style="text-align:left;">
ML classification model and regular data cube
</td>
<td style="text-align:left;">
Probability cube
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_smooth()
</td>
<td style="text-align:left;">
Probability cube
</td>
<td style="text-align:left;">
Post-processed probability cube
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_uncertainty()
</td>
<td style="text-align:left;">
Post-processed probability cube
</td>
<td style="text-align:left;">
Uncertainty cube
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_label_classification()
</td>
<td style="text-align:left;">
Post-processed probability cube
</td>
<td style="text-align:left;">
Classified map
</td>
</tr>
<tr>
<td style="text-align:left;font-family: monospace;color: RawSienna !important;">
sits_accuracy()
</td>
<td style="text-align:left;">
Classified map and validation samples
</td>
<td style="text-align:left;">
Accuracy assessment
</td>
</tr>
</tbody>
</table></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:api"></span>
<img src="images/sits_api.png" alt="Main functions of the sits API (source: authors)." width="100%" height="100%"><p class="caption">
Figure 2: Main functions of the sits API (source: authors).
</p>
</div>
<p>Additionally, experts can perform object-based image analysis (OBIA) with <code>sits</code>. In this case, before classifying the time series, one can use <code>sits_segments()</code> to create a set of closed polygons. These polygons are classified using a subset of the time series contained inside each segment. For details, see Chapter <a href="https://e-sensing.github.io/sitsbook/object-based-time-series-image-analysis.html">Object-based time series image analysis</a>.</p>
</div>
<div id="land-use-and-land-cover" class="section level2 unnumbered">
<h2>Land use and land cover<a class="anchor" aria-label="anchor" href="#land-use-and-land-cover"><i class="fas fa-link"></i></a>
</h2>
<p>Since <code>sits</code> aims mainly to support land use and land cover classification, this section presents a short discussion on the use of these terms. The UN Food and Agriculture Organization defines land cover as “the observed biophysical cover on the Earth’s surface” <span class="citation"><a href="references.html#ref-DiGregorio2016">[4]</a></span>. Land cover can be observed and mapped directly through remote sensing images. In FAO’s guidelines and reports, land use is described as “the human activities or purposes for which land is managed or exploited”. FAO’s land use classifications include classes such as cropland and pasture. Although <em>land cover</em> and <em>land use</em> denote different approaches for describing the Earth’s landscape, in practice there is considerable overlap between these concepts <span class="citation"><a href="references.html#ref-Comber2008b">[5]</a></span>. When classifying remote sensing images, natural areas are classified using land cover types (e.g, forest), while human-modified areas are described with land use classes (e.g., pasture).</p>
<p>One of the advantages of using image time series for land classification is its capacity of measuring changes in the landscape related to agricultural practices. For example, the time series of a vegetation index in an area of crop production will show a pattern of minima (planting and sowing stages) and maxima (flowering stage). Thus, classification schemas based on image time series data can be richer and more detailed than those associated only with land cover. In what follows, we use the term “land classification” to refer to image classification representing both land cover and land use classes.</p>
</div>
<div id="classes-and-labels" class="section level2 unnumbered">
<h2>Classes and labels<a class="anchor" aria-label="anchor" href="#classes-and-labels"><i class="fas fa-link"></i></a>
</h2>
<p>In this book, we distinguish between the concepts of “class” and “label”. A class denotes a group of spatial objects that share similar land cover and land use types, such as urban areas, forests, water bodies, or agricultural fields. Classes are defined based on the specific application or study being conducted, and they help to analyse the vast amount of data obtained from remote sensing imagery. A label is the assignment or identification given to a specific feature or object within an image. Labels are markers that indicate to which class a particular pixel, segment, or object belongs. Labels are essential for supervised classification methods, where a training dataset with known labels is used to train a machine learning algorithm to recognize and classify new, unlabeled data. Thus, a “class” represents the overall category or group of features, while a “label” refers to the specific assignment of a class to a particular feature or object within an image.</p>
</div>
<div id="creating-a-data-cube" class="section level2 unnumbered">
<h2>Creating a data cube<a class="anchor" aria-label="anchor" href="#creating-a-data-cube"><i class="fas fa-link"></i></a>
</h2>
<p>There are two kinds of data cubes in <code>sits</code>: (a) irregular data cubes generated by selecting image collections on cloud providers such as AWS and Planetary Computer; (b) regular data cubes with images fully covering a chosen area, where each image has the same spectral bands and spatial resolution, and images follow a set of adjacent and regular time intervals. Machine learning applications need regular data cubes. Please refer to Chapter <a href="https://e-sensing.github.io/sitsbook/earth-observation-data-cubes.html">Earth observation data cubes</a> for further details.</p>
<p>The first steps in using <code>sits</code> are: (a) select an analysis-ready data image collection available in a cloud provider or stored locally using <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code>; (b) if the collection is not regular, use <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> to build a regular data cube.</p>
<p>This section shows how to build a data cube from local images already organized as a regular data cube. The data cube is composed of MODIS MOD13Q1 images for the region close to the city of Sinop in Mato Grosso, Brazil. This region is one of the world’s largest producers of soybeans. All images have indexes NDVI and EVI covering a one-year period from 2013-09-14 to 2014-08-29 (we use “year-month-day” for dates). There are 23 time instances, each covering a 16-day period. This data is available in the package <code>sitsdata</code>.</p>
<p>To build a data cube from local files, users must provide information about the original source from which the data was obtained. In this case, <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> needs the parameters:</p>
<ol style="list-style-type: lower-alpha">
<li>
<code>source</code>, the cloud provider from where the data has been obtained (in this case, the Brazil Data Cube “BDC”);</li>
<li>
<code>collection</code>, the collection of the cloud provider from where the images have been extracted. In this case, data comes from the MOD13Q1 collection 6;</li>
<li>
<code>data_dir</code>, the local directory where the image files are stored;</li>
<li>
<code>parse_info</code>, a vector of strings stating how file names store information on “tile”, “band”, and “date”. In this case, local images are stored in files whose names are similar to <code>TERRA_MODIS_012010_EVI_2014-07-28.tif</code>. This file represents an image obtained by the MODIS sensor onboard the TERRA satellite, covering part of tile 012010 in the EVI band for date 2014-07-28.</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load package "tibble"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span></span>
<span><span class="co"># load packages "sits" and "sitsdata"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-sensing/sits/">sits</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-sensing/sitsdata/">sitsdata</a></span><span class="op">)</span></span>
<span><span class="co"># Create a data cube using local files</span></span>
<span><span class="va">sinop_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"BDC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"MOD13Q1-6.1"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"EVI"</span><span class="op">)</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/sinop"</span>, package <span class="op">=</span> <span class="st">"sitsdata"</span><span class="op">)</span>,</span>
<span>  parse_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"satellite"</span>, <span class="st">"sensor"</span>, <span class="st">"tile"</span>, <span class="st">"band"</span>, <span class="st">"date"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the NDVI for the first date (2013-09-14)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sinop_cube</span>,</span>
<span>  band <span class="op">=</span> <span class="st">"NDVI"</span>,</span>
<span>  dates <span class="op">=</span> <span class="st">"2013-09-14"</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"RdYlGn"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:introndvi"></span>
<img src="03-intro_files/figure-html/introndvi-1.png" alt="False color MODIS image for NDVI band in 2013-09-14 from sinop data cube (source: Brazil Data Cube)." width="100%"><p class="caption">
Figure 3: False color MODIS image for NDVI band in 2013-09-14 from sinop data cube (source: Brazil Data Cube).
</p>
</div>
<p>The aim of the <code>parse_info</code> parameter is to extract <code>tile</code>, <code>band</code>, and <code>date</code> information from the file name. Given the large variation in image file names generated by different produces, it includes designators such as <code>X1</code> and <code>X2</code>; these are place holders for parts of the file name that is not relevant to <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code>.</p>
<p>The R object returned by <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> contains the metadata describing the contents of the data cube. It includes data source and collection, satellite, sensor, tile in the collection, bounding box, projection, and list of files. Each file refers to one band of an image at one of the temporal instances of the cube.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the description of the data cube</span></span>
<span><span class="va">sinop_cube</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 11
#&gt;   source collection satellite sensor tile     xmin    xmax    ymin    ymax crs  
#&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;
#&gt; 1 BDC    MOD13Q1-6… TERRA     MODIS  0120… -6.18e6 -5.96e6 -1.35e6 -1.23e6 "PRO…
#&gt; # ℹ 1 more variable: file_info &lt;list&gt;</code></pre>
<p>The list of image files which make up the data cube is stored as a data frame in the column <code>file_info</code>. For each file, <code>sits</code> stores information about spectral band, reference date, size, spatial resolution, coordinate reference system, bounding box, path to file location and cloud cover information (when available).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show information on the images files which are part of a data cube</span></span>
<span><span class="va">sinop_cube</span><span class="op">$</span><span class="va">file_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 46 × 13
#&gt;    fid   band  date       nrows ncols  xres  yres      xmin      ymin      xmax
#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
#&gt;  1 1     EVI   2013-09-14   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  2 1     NDVI  2013-09-14   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  3 2     EVI   2013-09-30   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  4 2     NDVI  2013-09-30   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  5 3     EVI   2013-10-16   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  6 3     NDVI  2013-10-16   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  7 4     EVI   2013-11-01   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  8 4     NDVI  2013-11-01   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt;  9 5     EVI   2013-11-17   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt; 10 5     NDVI  2013-11-17   551   944  232.  232. -6181982. -1353336. -5963298.
#&gt; # ℹ 36 more rows
#&gt; # ℹ 3 more variables: ymax &lt;dbl&gt;, crs &lt;chr&gt;, path &lt;chr&gt;</code></pre>
<p>A key attribute of a data cube is its timeline, as shown below. The command <code><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline()</a></code> lists the temporal references associated to <code>sits</code> objects, including samples, data cubes and models.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the R object that describes the data cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">sinop_cube</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;  [1] "2013-09-14" "2013-09-30" "2013-10-16" "2013-11-01" "2013-11-17"
#&gt;  [6] "2013-12-03" "2013-12-19" "2014-01-01" "2014-01-17" "2014-02-02"
#&gt; [11] "2014-02-18" "2014-03-06" "2014-03-22" "2014-04-07" "2014-04-23"
#&gt; [16] "2014-05-09" "2014-05-25" "2014-06-10" "2014-06-26" "2014-07-12"
#&gt; [21] "2014-07-28" "2014-08-13" "2014-08-29"</code></pre>
<p>The timeline of the <code>sinop_cube</code> data cube has 23 intervals with a temporal difference of 16 days. The chosen dates capture the agricultural calendar in Mato Grosso, Brazil. The agricultural year starts in September-October with the sowing of the summer crop (usually soybeans) which is harvested in February-March. Then the winter crop (mostly Corn, Cotton or Millet) is planted in March and harvested in June-July. For LULC classification, the training samples and the date cube should share a timeline with the same number of intervals and similar start and end dates.</p>
</div>
<div id="the-time-series-tibble" class="section level2 unnumbered">
<h2>The time series tibble<a class="anchor" aria-label="anchor" href="#the-time-series-tibble"><i class="fas fa-link"></i></a>
</h2>
<p>To handle time series information, <code>sits</code> uses a <code>tibble</code>. Tibbles are extensions of the <code>data.frame</code> tabular data structures provided by the <code>tidyverse</code> set of packages. The example below shows a tibble with 1,837 time series obtained from MODIS MOD13Q1 images. Each series has four attributes: two bands (NIR and MIR) and two indexes (NDVI and EVI). This dataset is available in package <code>sitsdata</code>.</p>
<p>The time series tibble contains data and metadata. The first six columns contain the metadata: spatial and temporal information, the label assigned to the sample, and the data cube from where the data has been extracted. The <code>time_series</code> column contains the time series data for each spatiotemporal location. This data is also organized as a tibble, with a column with the dates and the other columns with the values for each spectral band.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the MODIS samples for Mato Grosso from the "sitsdata" package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/e-sensing/sitsdata/">sitsdata</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"samples_matogrosso_mod13q1"</span>, package <span class="op">=</span> <span class="st">"sitsdata"</span><span class="op">)</span></span>
<span><span class="va">samples_matogrosso_mod13q1</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1,837 × 7
#&gt;    longitude latitude start_date end_date   label   cube     time_series      
#&gt;        &lt;dbl&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;list&gt;           
#&gt;  1     -57.8    -9.76 2006-09-14 2007-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  2     -59.4    -9.31 2014-09-14 2015-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  3     -59.4    -9.31 2013-09-14 2014-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  4     -57.8    -9.76 2006-09-14 2007-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  5     -55.2   -10.8  2013-09-14 2014-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  6     -51.9   -13.4  2014-09-14 2015-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  7     -56.0   -10.1  2005-09-14 2006-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  8     -54.6   -10.4  2013-09-14 2014-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt;  9     -52.5   -11.0  2013-09-14 2014-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt; 10     -52.1   -14.0  2013-09-14 2014-08-29 Pasture bdc_cube &lt;tibble [23 × 5]&gt;
#&gt; # ℹ 1,827 more rows</code></pre>
<p>The timeline for all time series associated with the samples follows the same agricultural calendar, starting in September 14th and ending in August 28th. All samples contain 23 values, corresponding to the same temporal interval as those of the <code>sinop</code> data cube. Notice that that although the years for the samples are different, the samples for a given year follow the same agricultural calendar.</p>
<p>The time series can be displayed by showing the <code>time_series</code> column.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the time series for MODIS samples for Mato Grosso</span></span>
<span><span class="va">samples_matogrosso_mod13q1</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">$</span><span class="va">time_series</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 23 × 5
#&gt;    Index       NDVI   EVI   NIR    MIR
#&gt;    &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt;  1 2006-09-14 0.500 0.263 0.230 0.139 
#&gt;  2 2006-09-30 0.485 0.330 0.359 0.161 
#&gt;  3 2006-10-16 0.716 0.397 0.264 0.0757
#&gt;  4 2006-11-01 0.654 0.415 0.332 0.124 
#&gt;  5 2006-11-17 0.591 0.433 0.400 0.172 
#&gt;  6 2006-12-03 0.662 0.439 0.348 0.125 
#&gt;  7 2006-12-19 0.734 0.444 0.295 0.0784
#&gt;  8 2007-01-01 0.739 0.502 0.348 0.0887
#&gt;  9 2007-01-17 0.768 0.526 0.351 0.0761
#&gt; 10 2007-02-02 0.797 0.550 0.355 0.0634
#&gt; # ℹ 13 more rows</code></pre>
<p>The distribution of samples per class can be obtained using the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> command. The classification schema uses nine labels, four associated to crops (<code>Soy_Corn</code>, <code>Soy_Cotton</code>, <code>Soy_Fallow</code>, <code>Soy_Millet</code>), two with natural vegetation (<code>Cerrado</code>, <code>Forest</code>) and one to <code>Pasture</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the MODIS samples for Mato Grosso from the "sitsdata" package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">samples_matogrosso_mod13q1</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 7 × 3
#&gt;   label      count   prop
#&gt;   &lt;chr&gt;      &lt;int&gt;  &lt;dbl&gt;
#&gt; 1 Cerrado      379 0.206 
#&gt; 2 Forest       131 0.0713
#&gt; 3 Pasture      344 0.187 
#&gt; 4 Soy_Corn     364 0.198 
#&gt; 5 Soy_Cotton   352 0.192 
#&gt; 6 Soy_Fallow    87 0.0474
#&gt; 7 Soy_Millet   180 0.0980</code></pre>
<p>It is helpful to plot the dispersion of the time series. In what follows, for brevity, we will filter only one label (<code>Forest</code>) and select one index (NDVI). Note that for filtering the label we use a function from <code>dplyr</code> package, while for selecting the index we use <code><a href="https://rdrr.io/pkg/sits/man/sits_select.html">sits_select()</a></code>. We use two different functions for selection because of they way metadata is stored in a samples files. The labels for the samples are listed in column <code>label</code> in the samples tibble, as shown above. In this case, one can use functions from the <code>dplyr</code> package to extract subsets. In particular, the function <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter</a></code> retaining all rows that satisfy a given condition. In the above example, the result of <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter</a></code> is the set of samples associated to the “Forest” label. The second selection involves obtaining only the values for the NDVI band. This operation requires access to the <code>time_series</code> column, which is stored as a list. In this case, selection with <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter</a></code> will not work. To handle such cases, <code>sits</code> provides <code><a href="https://rdrr.io/pkg/sits/man/sits_select.html">sits_select()</a></code> to select subsets inside the <code>time_series</code> list.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select all samples with label "Forest"</span></span>
<span><span class="va">samples_forest</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">samples_matogrosso_mod13q1</span>,</span>
<span>  <span class="va">label</span> <span class="op">==</span> <span class="st">"Forest"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># select the NDVI band for all samples with label "Forest"</span></span>
<span><span class="va">samples_forest_ndvi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_select.html">sits_select</a></span><span class="op">(</span></span>
<span>  <span class="va">samples_forest</span>,</span>
<span>  band <span class="op">=</span> <span class="st">"NDVI"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">samples_forest_ndvi</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:timeseriesforest"></span>
<img src="03-intro_files/figure-html/timeseriesforest-1.png" alt="Joint plot of all samples in band NDVI for label Forest (source: authors)." width="80%"><p class="caption">
Figure 4: Joint plot of all samples in band NDVI for label Forest (source: authors).
</p>
</div>
<p>The above figure shows all the time series associated with label <code>Forest</code> and band NDVI (in light blue), highlighting the median (shown in dark red) and the first and third quartiles (shown in brown). The spikes are noise caused by the presence of clouds.</p>
</div>
<div id="training-a-machine-learning-model" class="section level2 unnumbered">
<h2>Training a machine learning model<a class="anchor" aria-label="anchor" href="#training-a-machine-learning-model"><i class="fas fa-link"></i></a>
</h2>
<p>The next step is to train a machine learning (ML) model using <code><a href="https://rdrr.io/pkg/sits/man/sits_train.html">sits_train()</a></code>. It takes two inputs, <code>samples</code> (a time series tibble) and <code>ml_method</code> (a function that implements a machine learning algorithm). The result is a model that is used for classification. Each ML algorithm requires specific parameters that are user-controllable. For novice users, <code>sits</code> provides default parameters that produce good results. Please see Chapter <a href="https://e-sensing.github.io/sitsbook/machine-learning-for-data-cubes.html">Machine learning for data cubes</a> for more details.</p>
<p>Since the time series data has four attributes (EVI, NDVI, NIR, and MIR) and the data cube images have only two, we select the NDVI and EVI values and use the resulting data for training. To build the classification model, we use a random forest model called by <code><a href="https://rdrr.io/pkg/sits/man/sits_rfor.html">sits_rfor()</a></code>. Results from the random forest model can vary between different runs, due to the stochastic nature of the algorithm, For this reason, in the code fragment below, we set the seed of R’s pseudo-random number generation explicitly to ensure the same results are produced for documentation purposes.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">03022024</span><span class="op">)</span></span>
<span><span class="co"># Select the bands NDVI and EVI</span></span>
<span><span class="va">samples_2bands</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_select.html">sits_select</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">samples_matogrosso_mod13q1</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"NDVI"</span>, <span class="st">"EVI"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Train a random forest model</span></span>
<span><span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_train.html">sits_train</a></span><span class="op">(</span></span>
<span>  samples <span class="op">=</span> <span class="va">samples_2bands</span>,</span>
<span>  ml_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_rfor.html">sits_rfor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the most important variables of the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_model</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rfintro"></span>
<img src="03-intro_files/figure-html/rfintro-1.png" alt="Most relevant variables of trained random forest model (source: authors)." width="80%"><p class="caption">
Figure 5: Most relevant variables of trained random forest model (source: authors).
</p>
</div>
</div>
<div id="data-cube-classification" class="section level2 unnumbered">
<h2>Data cube classification<a class="anchor" aria-label="anchor" href="#data-cube-classification"><i class="fas fa-link"></i></a>
</h2>
<p>After training the machine learning model, the next step is to classify the data cube using <code><a href="https://rdrr.io/pkg/sits/man/sits_classify.html">sits_classify()</a></code>. This function produces a set of raster probability maps, one for each class. For each of these maps, the value of a pixel is proportional to the probability that it belongs to the class. This function has two mandatory parameters: <code>data</code>, the data cube or time series tibble to be classified; and <code>ml_model</code>, the trained ML model. Optional parameters include: (a) <code>multicores</code>, number of cores to be used; (b) <code>memsize</code>, RAM used in the classification; (c) <code>output_dir</code>, the directory where the classified raster files will be written. Details of the classification process are available in “Image classification in data cubes”.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Classify the raster image</span></span>
<span><span class="va">sinop_probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_classify.html">sits_classify</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">sinop_cube</span>,</span>
<span>  ml_model <span class="op">=</span> <span class="va">rf_model</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp3"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the probability cube for class Forest</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sinop_probs</span>, labels <span class="op">=</span> <span class="st">"Forest"</span>, palette <span class="op">=</span> <span class="st">"BuGn"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pbforintro"></span>
<img src="03-intro_files/figure-html/pbforintro-1.png" alt="Probability map for class Forest (source: authors)." width="90%"><p class="caption">
Figure 6: Probability map for class Forest (source: authors).
</p>
</div>
<p>After completing the classification, we plot the probability maps for class <code>Forest</code>. Probability maps are helpful to visualize the degree of confidence the classifier assigns to the labels for each pixel. They can be used to produce uncertainty information and support active learning, as described in Chapter <a href="https://e-sensing.github.io/sitsbook/image-classification-in-data-cubes.html">Image classification in data cubes</a>.</p>
</div>
<div id="spatial-smoothing" class="section level2 unnumbered">
<h2>Spatial smoothing<a class="anchor" aria-label="anchor" href="#spatial-smoothing"><i class="fas fa-link"></i></a>
</h2>
<p>When working with big Earth observation data, there is much variability in each class. As a result, some pixels will be misclassified. These errors are more likely to occur in transition areas between classes. To address these problems, <code><a href="https://rdrr.io/pkg/sits/man/sits_smooth.html">sits_smooth()</a></code> takes a probability cube as input and uses the class probabilities of each pixel’s neighborhood to reduce labeling uncertainty. Plotting the smoothed probability map for class Forest shows that most outliers have been removed.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Perform spatial smoothing</span></span>
<span><span class="va">sinop_bayes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_smooth.html">sits_smooth</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">sinop_probs</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp3"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sinop_bayes</span>, labels <span class="op">=</span> <span class="st">"Forest"</span>, palette <span class="op">=</span> <span class="st">"BuGn"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:byforintro"></span>
<img src="03-intro_files/figure-html/byforintro-1.png" alt="Smoothed probability map for class Forest (source: authors)." width="90%"><p class="caption">
Figure 7: Smoothed probability map for class Forest (source: authors).
</p>
</div>
</div>
<div id="labeling-a-probability-data-cube" class="section level2 unnumbered">
<h2>Labeling a probability data cube<a class="anchor" aria-label="anchor" href="#labeling-a-probability-data-cube"><i class="fas fa-link"></i></a>
</h2>
<p>After removing outliers using local smoothing, the final classification map can be obtained using <code><a href="https://rdrr.io/pkg/sits/man/sits_label_classification.html">sits_label_classification()</a></code>. This function assigns each pixel to the class with the highest probability.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Label the probability file</span></span>
<span><span class="va">sinop_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_label_classification.html">sits_label_classification</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">sinop_bayes</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp3"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sinop_map</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mapintro"></span>
<img src="03-intro_files/figure-html/mapintro-1.png" alt="Classification map for Sinop (source: authors)." width="100%"><p class="caption">
Figure 8: Classification map for Sinop (source: authors).
</p>
</div>
<p>The resulting classification files can be read by QGIS. Links to the associated files are available in the <code>sinop_map</code> object in the nested table <code>file_info</code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the location of the classification file</span></span>
<span><span class="va">sinop_map</span><span class="op">$</span><span class="va">file_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 12
#&gt;   band  start_date end_date   ncols nrows  xres  yres      xmin     xmax    ymin
#&gt;   &lt;chr&gt; &lt;date&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
#&gt; 1 class 2013-09-14 2014-08-29   944   551  232.  232. -6181982.  -5.96e6 -1.35e6
#&gt; # ℹ 2 more variables: ymax &lt;dbl&gt;, path &lt;chr&gt;</code></pre>
<p>To simplify the process of importing your data to QGIS, the color palette used to display classified maps in <code>sits</code> can be exported as a QGIS style using <code>sits_colors_qgis</code>. The function takes two parameters: (a) <code>cube</code>, a classified data cube; and (b) <code>file</code>, the file where the QGIS style in XML will be written to. In this case study, it suffices to do the following command.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the location of the classification file</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_colors_qgis.html">sits_colors_qgis</a></span><span class="op">(</span><span class="va">sinop_map</span>, file <span class="op">=</span> <span class="st">"./tempdir/chp3/qgis_style.xml"</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="plotting" class="section level2 unnumbered">
<h2>Plotting<a class="anchor" aria-label="anchor" href="#plotting"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function produces a graphical display of data cubes, time series, models, and SOM maps. For each type of data, there is a dedicated version of the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function. See <code><a href="https://rdrr.io/pkg/sits/man/plot.html">?plot.sits</a></code> for details. Plotting of time series, models and SOM outputs uses the <code>ggplot2</code> package; maps are plotted using the <code>tmap</code> package. When plotting images and classified maps, users can control the output, which appropriate parameters for each type of image.</p>
<ul>
<li>For false color maps, DEM maps, and probability maps:
<ul>
<li>
<code>band</code>: band or index to be plotted;</li>
<li>
<code>pallete</code>: color scheme to be used for false color maps, which should be one of the <code>RColorBrewer</code> palettes. These palettes have been designed to be effective for map display by Prof Cynthia Brewer as described at the <a href="http://colorbrewer2.org">Brewer website</a>. By default, optical images use the <code>RdYlGn</code> scheme, SAR images use <code>Greys</code>, and DEM cubes use <code>Spectral</code>.</li>
<li>
<code>rev</code>: whether the color palette should be reversed; <code>TRUE</code> for DEM cubes, and <code>FALSE</code> otherwise.</li>
<li>
<code>scale</code>: global scale parameter used by <code>tmap</code>. All font sizes, symbol sizes, border widths, and line widths are controlled by this value. Default is 0.75; users should vary this parameter and see the results.</li>
<li>
<code>first_quantile</code>: 1st quantile for stretching images (default = 0.05).</li>
<li>
<code>last_quantile</code>: last quantile for stretching images (default = 0.95).</li>
<li>
<code>max_cog_size</code>: for cloud-oriented geotiff files (COG), sets the maximum number of lines or columns of the COG overview to be used for plotting.</li>
</ul>
</li>
<li>For RGB color maps:
<ul>
<li>
<code>red</code>: band or index associated to the red color;</li>
<li>
<code>green</code>: band or index associated to the green color;</li>
<li>
<code>blue</code>: band or index associated to the blue color;</li>
<li>
<code>first_quantile</code>: 1st quantile for stretching images (default = 0.05)</li>
<li>
<code>last_quantile</code>: last quantile for stretching images (default = 0.95)</li>
</ul>
</li>
<li>For classified maps:
<ul>
<li>
<code>legend</code>: legend which associated colors to the classes; should be a named vector with classes as names and valid R colors as values. For example, <code>c("Forest" = "green", "Water" = "blue")</code> or <code>c("Forest" = "#1E8449", "Water" = "#2980B9")</code>.</li>
<li>
<code>scale</code>: global scale parameter used by <code>tmap</code>.</li>
<li>
<code>max_cog_size</code>: max number of lines or columns to be read when COG files are available;</li>
<li>
<code>palette</code>: color palette to be used if legend is not available and colors are not defined in the <code>sits</code> color table.</li>
</ul>
</li>
</ul>
<p>COG overviews are reduced-resolution versions of the main image, stored within the same file. Overviews allow for quick rendering at lower zoom levels, improving performance when dealing with large images. Usually, a single GeoTIFF will have many overviews, to match different zoom levels. The parameter <code>max_cog_size</code> controls the size of the overview which will be used for visualisation.</p>
<p>The following optional parameters are available to allow for detailed control over the plot output:
- <code>graticules_labels_size</code>: size of coordinates labels (default = 0.8).
- <code>legend_title_size</code>: relative size of legend title (default = 1.0).
- <code>legend_text_size</code>: relative size of legend text (default = 1.0).
- <code>legend_bg_color</code>: color of legend background (default = “white”).
- <code>legend_bg_alpha</code>: legend opacity (default = 0.5).
- <code>legend_position</code>: where to place the legend (options = “inside” or “outside”).</p>
</div>
<div id="visualization-of-data-cubes-in-interactive-maps" class="section level2 unnumbered">
<h2>Visualization of data cubes in interactive maps<a class="anchor" aria-label="anchor" href="#visualization-of-data-cubes-in-interactive-maps"><i class="fas fa-link"></i></a>
</h2>
<p>Data cubes and samples can also be shown as interactive maps using <code><a href="https://rdrr.io/pkg/sits/man/sits_view.html">sits_view()</a></code>. This function creates tiled overlays of different kinds of data cubes, allowing comparison between the original, intermediate and final results. It also includes background maps. The following example creates an interactive map combining the original data cube with the classified map.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_view.html">sits_view</a></span><span class="op">(</span><span class="va">sinop</span>, band <span class="op">=</span> <span class="st">"NDVI"</span>, class_cube <span class="op">=</span> <span class="va">sinop_map</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/view_sinop.png" width="90%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="acknowledgements.html">Acknowledgements</a></div>
<div class="next"><a href="earth-observation-data-cubes.html">Earth observation data cubes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduction">Introduction</a></li>
<li><a class="nav-link" href="#who-is-this-book-for">Who is this book for?</a></li>
<li><a class="nav-link" href="#why-work-with-satellite-image-time-series">Why work with satellite image time series?</a></li>
<li><a class="nav-link" href="#time-first-space-later">Time-first, space-later</a></li>
<li><a class="nav-link" href="#how-sits-works">How sits works</a></li>
<li><a class="nav-link" href="#land-use-and-land-cover">Land use and land cover</a></li>
<li><a class="nav-link" href="#classes-and-labels">Classes and labels</a></li>
<li><a class="nav-link" href="#creating-a-data-cube">Creating a data cube</a></li>
<li><a class="nav-link" href="#the-time-series-tibble">The time series tibble</a></li>
<li><a class="nav-link" href="#training-a-machine-learning-model">Training a machine learning model</a></li>
<li><a class="nav-link" href="#data-cube-classification">Data cube classification</a></li>
<li><a class="nav-link" href="#spatial-smoothing">Spatial smoothing</a></li>
<li><a class="nav-link" href="#labeling-a-probability-data-cube">Labeling a probability data cube</a></li>
<li><a class="nav-link" href="#plotting">Plotting</a></li>
<li><a class="nav-link" href="#visualization-of-data-cubes-in-interactive-maps">Visualization of data cubes in interactive maps</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</strong>" was written by Gilberto Camara, Rolf Simoes, Felipe Souza, Felipe Menino, Charlotte Pelletier, Pedro R. Andrade, Karine Ferreira, Gilberto Queiroz. It was last built on 2024-08-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
