<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Data visualisation in sits | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes</title>
<meta name="author" content="Gilberto Camara">
<meta name="author" content="Rolf Simoes">
<meta name="author" content="Felipe Souza">
<meta name="author" content="Felipe Menino">
<meta name="author" content="Charlotte Pelletier">
<meta name="author" content="Pedro R. Andrade">
<meta name="author" content="Karine Ferreira">
<meta name="author" content="Gilberto Queiroz">
<meta name="description" content="This Chapter contains a discussion on plotting and visualisation of data cubes in sits. Plotting The plot() function produces a graphical display of data cubes, time series, models, and SOM maps....">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Data visualisation in sits | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover_sits_book.png">
<meta property="og:description" content="This Chapter contains a discussion on plotting and visualisation of data cubes in sits. Plotting The plot() function produces a graphical display of data cubes, time series, models, and SOM maps....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Data visualisation in sits | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta name="twitter:description" content="This Chapter contains a discussion on plotting and visualisation of data cubes in sits. Plotting The plot() function produces a graphical display of data cubes, time series, models, and SOM maps....">
<meta name="twitter:image" content="/images/cover_sits_book.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/IBM_Plex_Serif-0.4.9/font.css" rel="stylesheet">
<link href="libs/IBM_Plex_Mono-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="setup.html">Setup</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li><a class="" href="earth-observation-data-cubes.html">Earth observation data cubes</a></li>
<li><a class="" href="operations-on-data-cubes.html">Operations on data cubes</a></li>
<li><a class="" href="working-with-time-series.html">Working with time series</a></li>
<li><a class="" href="improving-the-quality-of-training-samples.html">Improving the quality of training samples</a></li>
<li><a class="" href="machine-learning-for-data-cubes.html">Machine learning for data cubes</a></li>
<li><a class="" href="classification-of-raster-data-cubes.html">Classification of raster data cubes</a></li>
<li><a class="" href="bayesian-smoothing-for-post-processing.html">Bayesian smoothing for post-processing</a></li>
<li><a class="" href="validation-and-accuracy-measurements.html">Validation and accuracy measurements</a></li>
<li><a class="" href="uncertainty-and-active-learning.html">Uncertainty and active learning</a></li>
<li><a class="" href="ensemble-prediction-from-multiple-models.html">Ensemble prediction from multiple models</a></li>
<li><a class="" href="object-based-time-series-image-analysis.html">Object-based time series image analysis</a></li>
<li><a class="active" href="data-visualisation-in-sits.html">Data visualisation in sits</a></li>
<li><a class="" href="technical-annex.html">Technical annex</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-visualisation-in-sits" class="section level1 unnumbered">
<h1>Data visualisation in <code>sits</code><a class="anchor" aria-label="anchor" href="#data-visualisation-in-sits"><i class="fas fa-link"></i></a>
</h1>
<p>This Chapter contains a discussion on plotting and visualisation of data cubes in <code>sits</code>.</p>
<div id="plotting" class="section level2 unnumbered">
<h2>Plotting<a class="anchor" aria-label="anchor" href="#plotting"><i class="fas fa-link"></i></a>
</h2>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function produces a graphical display of data cubes, time series, models, and SOM maps. For each type of data, there is a dedicated version of the <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> function. See <code><a href="https://rdrr.io/pkg/sits/man/plot.html">?plot.sits</a></code> for details. Plotting of time series, models and SOM outputs uses the <code>ggplot2</code> package; maps are plotted using the <code>tmap</code> package. When plotting images and classified maps, users can control the output, which appropriate parameters for each type of image. In this chapter, we provide examples of the options available for plotting different types of maps.</p>
<p>Plotting and visualisation function in <code>sits</code> use COG overview if available. COG overviews are reduced-resolution versions of the main image, stored within the same file. Overviews allow for quick rendering at lower zoom levels, improving performance when dealing with large images. Usually, a single GeoTIFF will have many overviews, to match different zoom levels</p>
<div id="plotting-false-color-maps" class="section level3 unnumbered">
<h3>Plotting false color maps<a class="anchor" aria-label="anchor" href="#plotting-false-color-maps"><i class="fas fa-link"></i></a>
</h3>
<p>We refer to false color maps as images which are plotted on a color scale. Usually these are single bands, indexes such as NDVI or DEMs. For these data sets, the parameters for <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> are:</p>
<ul>
<li>
<code>x</code>: data cube containing data to be visualised;</li>
<li>
<code>band</code>: band or index to be plotted;</li>
<li>
<code>pallete</code>: color scheme to be used for false color maps, which should be one of the <code>RColorBrewer</code> palettes. These palettes have been designed to be effective for map display by Prof Cynthia Brewer as described at the <a href="http://colorbrewer2.org">Brewer website</a>. By default, optical images use the <code>RdYlGn</code> scheme, SAR images use <code>Greys</code>, and DEM cubes use <code>Spectral</code>.</li>
<li>
<code>rev</code>: whether the color palette should be reversed; <code>TRUE</code> for DEM cubes, and <code>FALSE</code> otherwise.</li>
<li>
<code>scale</code>: global scale parameter used by <code>tmap</code>. All font sizes, symbol sizes, border widths, and line widths are controlled by this value. Default is 0.75; users should vary this parameter and see the results.</li>
<li>
<code>first_quantile</code>: 1st quantile for stretching images (default = 0.05).</li>
<li>
<code>last_quantile</code>: last quantile for stretching images (default = 0.95).</li>
<li>
<code>max_cog_size</code>: for cloud-oriented geotiff files (COG), sets the maximum number of lines or columns of the COG overview to be used for plotting.</li>
</ul>
<p>The following optional parameters are available to allow for detailed control over the plot output:
- <code>graticules_labels_size</code>: size of coordinates labels (default = 0.8).
- <code>legend_title_size</code>: relative size of legend title (default = 1.0).
- <code>legend_text_size</code>: relative size of legend text (default = 1.0).
- <code>legend_bg_color</code>: color of legend background (default = “white”).
- <code>legend_bg_alpha</code>: legend opacity (default = 0.5).
- <code>legend_position</code>: where to place the legend (options = “inside” or “outside” with “inside” as default).</p>
<p>The following example shows a plot of an NDVI index of a data cube. This data cube covers part of MGRS tile <code>20LMR</code> and contains bands “B02”, “B03”, “B04”, “B05”, “B06”, “B07”, “B08”, “B11”, “B12”, “B8A”, “EVI”, “NBR”, and “NDVI” for the period 2022-01-05 to 2022-12-23. We will use parameters with other than their defaults.</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set the directory where the data is</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Rondonia-20LMR"</span>, package <span class="op">=</span> <span class="st">"sitsdata"</span><span class="op">)</span></span>
<span><span class="co"># read the data cube</span></span>
<span><span class="va">ro_20LMR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot the NDVI for date 2022-08-01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ro_20LMR</span>,</span>
<span>  band <span class="op">=</span> <span class="st">"NDVI"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2022-08-01"</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Greens"</span>,</span>
<span>  legend_position <span class="op">=</span> <span class="st">"outside"</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:visndvi"></span>
<img src="15-visualisation_files/figure-html/visndvi-1.png" alt="Sentinel-2 NDVI index covering tile 20LMR (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft modified by authors)." width="100%"><p class="caption">
Figure 114: Sentinel-2 NDVI index covering tile 20LMR (© EU Copernicus Sentinel Programme; source: Microsoft modified by authors).
</p>
</div>
</div>
<div id="plotting-rgb-color-composite-maps" class="section level3 unnumbered">
<h3>Plotting RGB color composite maps<a class="anchor" aria-label="anchor" href="#plotting-rgb-color-composite-maps"><i class="fas fa-link"></i></a>
</h3>
<p>For RGB color composite maps, the parameters for the <code>plot</code> function are:</p>
<ul>
<li>
<code>x</code>: data cube containing data to be visualised;</li>
<li>
<code>band</code>: band or index to be plotted;</li>
<li>
<code>date</code>: date to be plotted (must be part of the cube timeline);</li>
<li>
<code>red</code>: band or index associated to the red color;</li>
<li>
<code>green</code>: band or index associated to the green color;</li>
<li>
<code>blue</code>: band or index associated to the blue color;</li>
<li>
<code>scale</code>: global scale parameter used by <code>tmap</code>. All font sizes, symbol sizes, border widths, and line widths are controlled by this value. Default is 0.75; users should vary this parameter and see the results.</li>
<li>
<code>first_quantile</code>: 1st quantile for stretching images (default = 0.05).</li>
<li>
<code>last_quantile</code>: last quantile for stretching images (default = 0.95).</li>
<li>
<code>max_cog_size</code>: for cloud-oriented geotiff files (COG), sets the maximum number of lines or columns of the COG overview to be used for plotting.</li>
</ul>
<p>The optional parameters listed in the previous section are also available. An example follows:</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the NDVI for date 2022-08-01</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ro_20LMR</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B11"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"B8A"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"B02"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2022-08-01"</span>,</span>
<span>  palette <span class="op">=</span> <span class="st">"Greens"</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:visrgb"></span>
<img src="15-visualisation_files/figure-html/visrgb-1.png" alt="Sentinel-2 color composite covering tile 20LMR (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft modified by authors)." width="100%"><p class="caption">
Figure 115: Sentinel-2 color composite covering tile 20LMR (© EU Copernicus Sentinel Programme; source: Microsoft modified by authors).
</p>
</div>
</div>
<div id="plotting-classified-maps" class="section level3 unnumbered">
<h3>Plotting classified maps<a class="anchor" aria-label="anchor" href="#plotting-classified-maps"><i class="fas fa-link"></i></a>
</h3>
<p>Classified maps pose an additional challenge for plotting because of the association between labels and colors. In this case, <code>sits</code> allows three alternatives:</p>
<ul>
<li>Predefined color scheme: <code>sits</code> includes some well-established color schemes such as <code>IBGP</code>, <code>UMD</code>, <code>ESA_CCI_LC</code>, and <code>WORLDCOVER</code>. There is a predefined color table with associates labels commonly used in LUCC classification to colors. Users can also create their color schemas. Please see section “How Colors Work on <code>sits</code> in this chapter.</li>
<li>legend: in this case, users provide a named vector with labels and colors, as shown in the example below.</li>
<li>palette: an RColorBrewer categorical palette, which is assigned to labels which are not in the color table.</li>
</ul>
<p>The parameters for <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> applied to a classified data cube are:</p>
<ul>
<li>
<code>x</code>: data cube containing a classified map;</li>
<li>
<code>legend</code>: legend which associated colors to the classes, which is <code>NULL</code> by default.</li>
<li>
<code>palette</code>: color palette used for undefined colors, which is <code>Spectral</code> by default.</li>
<li>
<code>scale</code>: global scale parameter used by <code>tmap</code>.</li>
</ul>
<p>The optional parameters listed in the previous section are also available. For an example of plotting a classified data cube with default color scheme, please see the section “Reading classified images as local data cube” in the “Earth observation data cubes” chapter. In what follows we show a similar case using a legend.</p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a cube based on a classified image</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Rondonia-20LLP"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sitsdata"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Read the classified cube</span></span>
<span><span class="va">rondonia_class_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"AWS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-S2-L2A-COGS"</span>,</span>
<span>  bands <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Burned"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Cleared"</span>,</span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="st">"Degraded"</span>, <span class="st">"4"</span> <span class="op">=</span> <span class="st">"Natural_Forest"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the classified cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rondonia_class_cube</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Burned"</span> <span class="op">=</span> <span class="st">"#a93226"</span>,</span>
<span>    <span class="st">"Cleared"</span> <span class="op">=</span> <span class="st">"#f9e79f"</span>,</span>
<span>    <span class="st">"Degraded"</span> <span class="op">=</span> <span class="st">"#d4efdf"</span>,</span>
<span>    <span class="st">"Natural_Forest"</span> <span class="op">=</span> <span class="st">"#1e8449"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  scale <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  legend_position <span class="op">=</span> <span class="st">"outside"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:vismap"></span>
<img src="15-visualisation_files/figure-html/vismap-1.png" alt="Classified data cube for the year 2020/2021 in Rondonia, Brazil (&amp;copy; EU Copernicus Sentinel Programme; source: authors)." width="100%"><p class="caption">
Figure 116: Classified data cube for the year 2020/2021 in Rondonia, Brazil (© EU Copernicus Sentinel Programme; source: authors).
</p>
</div>
</div>
</div>
<div id="visualization-of-data-cubes-in-interactive-maps" class="section level2 unnumbered">
<h2>Visualization of data cubes in interactive maps<a class="anchor" aria-label="anchor" href="#visualization-of-data-cubes-in-interactive-maps"><i class="fas fa-link"></i></a>
</h2>
<p>Data cubes and samples can also be shown as interactive maps using <code><a href="https://rdrr.io/pkg/sits/man/sits_view.html">sits_view()</a></code>. This function creates tiled overlays of different kinds of data cubes, allowing comparison between the original, intermediate and final results. It also includes background maps. The following example creates an interactive map combining the original data cube with the classified map.</p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_view.html">sits_view</a></span><span class="op">(</span><span class="va">rondonia_class_cube</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Burned"</span> <span class="op">=</span> <span class="st">"#a93226"</span>,</span>
<span>    <span class="st">"Cleared"</span> <span class="op">=</span> <span class="st">"#f9e79f"</span>,</span>
<span>    <span class="st">"Degraded"</span> <span class="op">=</span> <span class="st">"#d4efdf"</span>,</span>
<span>    <span class="st">"Natural_Forest"</span> <span class="op">=</span> <span class="st">"#1e8449"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="images/view_rondonia_class_cube.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="how-colors-work-in-sits" class="section level2 unnumbered">
<h2>How colors work in sits<a class="anchor" aria-label="anchor" href="#how-colors-work-in-sits"><i class="fas fa-link"></i></a>
</h2>
<p>In examples provided in the book, the color legend is taken from a predefined color pallete provided by <code>sits</code>. The default color definition file used by <code>sits</code> has 220 class names, which can be shown using <code><a href="https://rdrr.io/pkg/sits/man/sits_colors.html">sits_colors()</a></code></p>
<pre><code>#&gt; [1] "Returning all available colors"</code></pre>
<pre><code>#&gt; # A tibble: 241 × 2
#&gt;    name                             color  
#&gt;    &lt;chr&gt;                            &lt;chr&gt;  
#&gt;  1 Evergreen_Broadleaf_Forest       #1E8449
#&gt;  2 Evergreen_Broadleaf_Forests      #1E8449
#&gt;  3 Tree_Cover_Broadleaved_Evergreen #1E8449
#&gt;  4 Forest                           #1E8449
#&gt;  5 Forests                          #1E8449
#&gt;  6 Closed_Forest                    #1E8449
#&gt;  7 Closed_Forests                   #1E8449
#&gt;  8 Mountainside_Forest              #229C59
#&gt;  9 Mountainside_Forests             #229C59
#&gt; 10 Open_Forest                      #53A145
#&gt; # ℹ 231 more rows</code></pre>
<p>These colors are grouped by typical legends used by the Earth observation community, which include “IGBP”, “UMD”, “ESA_CCI_LC”, “WORLDCOVER”, “PRODES”, “PRODES_VISUAL”, “TERRA_CLASS”, “TERRA_CLASS_PT”. The following commands shows the colors associated with the IGBP legend <span class="citation"><a href="references.html#ref-Herold2009">[94]</a></span>.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display default `sits` colors</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_colors_show.html">sits_colors_show</a></span><span class="op">(</span>legend <span class="op">=</span> <span class="st">"IGBP"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-4"></span>
<img src="15-visualisation_files/figure-html/unnamed-chunk-4-1.png" alt="Colors used in the sits package to represeny IGBP legend (source: authors)." width="100%" height="100%"><p class="caption">
Figure 117: Colors used in the sits package to represeny IGBP legend (source: authors).
</p>
</div>
<p>The default color table can be extended using <code><a href="https://rdrr.io/pkg/sits/man/sits_colors_set.html">sits_colors_set()</a></code>. As an example of a user-defined color table, consider a definition that covers level 1 of the Anderson Classification System used in the US National Land Cover Data, obtained by defining a set of colors associated to a new legend. The colors should be defined by HEX values and the color names should consist of a single string; multiple names need to be connected with an underscore(“_“).</p>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a color table based on the Anderson Land Classification System</span></span>
<span><span class="va">us_nlcd</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">us_nlcd</span> <span class="op">&lt;-</span> <span class="va">us_nlcd</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Urban_Built_Up"</span>, color <span class="op">=</span> <span class="st">"#85929E"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Agricultural_Land"</span>, color <span class="op">=</span> <span class="st">"#F0B27A"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Rangeland"</span>, color <span class="op">=</span> <span class="st">"#F1C40F"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Forest_Land"</span>, color <span class="op">=</span> <span class="st">"#27AE60"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Water"</span>, color <span class="op">=</span> <span class="st">"#2980B9"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Wetland"</span>, color <span class="op">=</span> <span class="st">"#D4E6F1"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Barren_Land"</span>, color <span class="op">=</span> <span class="st">"#FDEBD0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Tundra"</span>, color <span class="op">=</span> <span class="st">"#EBDEF0"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html">add_row</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Snow_and_Ice"</span>, color <span class="op">=</span> <span class="st">"#F7F9F9"</span><span class="op">)</span></span>
<span><span class="co"># Load the color table into `sits`</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_colors_set.html">sits_colors_set</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="va">us_nlcd</span>, legend <span class="op">=</span> <span class="st">"US_NLCD"</span><span class="op">)</span></span>
<span><span class="co"># Show the new legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_colors_show.html">sits_colors_show</a></span><span class="op">(</span>legend <span class="op">=</span> <span class="st">"US_NLCD"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:colors"></span>
<img src="15-visualisation_files/figure-html/colors-1.png" alt="Example of defining colors for the Anderson Land Classification Scheme(source: authors)." width="100%" height="80%"><p class="caption">
Figure 118: Example of defining colors for the Anderson Land Classification Scheme(source: authors).
</p>
</div>
<p>The original default <code>sits</code> color table can be restored using <code><a href="https://rdrr.io/pkg/sits/man/sits_colors_reset.html">sits_colors_reset()</a></code>.</p>
</div>
<div id="exporting-colors-to-qgis" class="section level2 unnumbered">
<h2>Exporting colors to QGIS<a class="anchor" aria-label="anchor" href="#exporting-colors-to-qgis"><i class="fas fa-link"></i></a>
</h2>
<p>To simplify the process of importing your data to QGIS, the color palette used to display classified maps in <code>sits</code> can be exported as a QGIS style using <code>sits_colors_qgis</code>. The function takes two parameters: (a) <code>cube</code>, a classified data cube; and (b) <code>file</code>, the file where the QGIS style in XML will be written to. In this case study, we first retrieve and plot a classified data cube and then export the colors to a QGIS XML style.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a cube based on a classified image</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Rondonia-Class-2022-Mosaic"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sitsdata"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># labels of the classified image</span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Clear_Cut_Bare_Soil"</span>,</span>
<span>  <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Clear_Cut_Burned_Area"</span>,</span>
<span>  <span class="st">"3"</span> <span class="op">=</span> <span class="st">"Clear_Cut_Vegetation"</span>,</span>
<span>  <span class="st">"4"</span> <span class="op">=</span> <span class="st">"Forest"</span>,</span>
<span>  <span class="st">"5"</span> <span class="op">=</span> <span class="st">"Mountainside_Forest"</span>,</span>
<span>  <span class="st">"6"</span> <span class="op">=</span> <span class="st">"Riparian_Forest"</span>,</span>
<span>  <span class="st">"7"</span> <span class="op">=</span> <span class="st">"Seasonally_Flooded"</span>,</span>
<span>  <span class="st">"8"</span> <span class="op">=</span> <span class="st">"Water"</span>,</span>
<span>  <span class="st">"9"</span> <span class="op">=</span> <span class="st">"Wetland"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># read classified data cube</span></span>
<span><span class="va">ro_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>  bands <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>  labels <span class="op">=</span> <span class="va">labels</span>,</span>
<span>  version <span class="op">=</span> <span class="st">"mosaic"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the classified cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ro_class</span>, scale <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:visqgis"></span>
<img src="15-visualisation_files/figure-html/visqgis-1.png" alt="Classified data cube for the year 2022 for Rondonia, Brazil (&amp;copy; EU Copernicus Sentinel Programme; source: authors)." width="100%"><p class="caption">
Figure 119: Classified data cube for the year 2022 for Rondonia, Brazil (© EU Copernicus Sentinel Programme; source: authors).
</p>
</div>
<p>The file to be read by QGIS is a TIFF file whose location is informed by the data cube, as follows.</p>
<div class="sourceCode" id="cb255"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Show the location of the classified map</span></span>
<span><span class="va">ro_class</span><span class="op">[[</span><span class="st">"file_info"</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">path</span></span></code></pre></div>
<pre><code>#&gt; [1] "/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/sitsdata/extdata/Rondonia-Class-2022-Mosaic/SENTINEL-2_MSI_MOSAIC_2022-01-05_2022-12-23_class_mosaic.tif"</code></pre>
<p>The color schema can be exported to QGIS as follows.</p>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Export the color schema to QGIS</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_colors_qgis.html">sits_colors_qgis</a></span><span class="op">(</span><span class="va">ro_class</span>, file <span class="op">=</span> <span class="st">"./tempdir/chp15/qgis_style.xml"</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="object-based-time-series-image-analysis.html">Object-based time series image analysis</a></div>
<div class="next"><a href="technical-annex.html">Technical annex</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-visualisation-in-sits">Data visualisation in sits</a></li>
<li>
<a class="nav-link" href="#plotting">Plotting</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#plotting-false-color-maps">Plotting false color maps</a></li>
<li><a class="nav-link" href="#plotting-rgb-color-composite-maps">Plotting RGB color composite maps</a></li>
<li><a class="nav-link" href="#plotting-classified-maps">Plotting classified maps</a></li>
</ul>
</li>
<li><a class="nav-link" href="#visualization-of-data-cubes-in-interactive-maps">Visualization of data cubes in interactive maps</a></li>
<li><a class="nav-link" href="#how-colors-work-in-sits">How colors work in sits</a></li>
<li><a class="nav-link" href="#exporting-colors-to-qgis">Exporting colors to QGIS</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</strong>" was written by Gilberto Camara, Rolf Simoes, Felipe Souza, Felipe Menino, Charlotte Pelletier, Pedro R. Andrade, Karine Ferreira, Gilberto Queiroz. It was last built on 2024-09-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
