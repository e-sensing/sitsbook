<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Earth observation data cubes | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes</title>
<meta name="author" content="Gilberto Camara">
<meta name="author" content="Rolf Simoes">
<meta name="author" content="Felipe Souza">
<meta name="author" content="Felipe Menino">
<meta name="author" content="Charlotte Pelletier">
<meta name="author" content="Pedro R. Andrade">
<meta name="author" content="Karine Ferreira">
<meta name="author" content="Gilberto Queiroz">
<meta name="description" content="Analysis-ready data(ARD) Analysis Ready Data (CEOS-ARD) are satellite data that have been processed to meet the ARD standards defined by the Committee on Earth Observation Satellites (CEOS). ARD...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="Earth observation data cubes | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover_sits_book.png">
<meta property="og:description" content="Analysis-ready data(ARD) Analysis Ready Data (CEOS-ARD) are satellite data that have been processed to meet the ARD standards defined by the Committee on Earth Observation Satellites (CEOS). ARD...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Earth observation data cubes | sits: Satellite Image Time Series Analysis on Earth Observation Data Cubes">
<meta name="twitter:description" content="Analysis-ready data(ARD) Analysis Ready Data (CEOS-ARD) are satellite data that have been processed to meet the ARD standards defined by the Committee on Earth Observation Satellites (CEOS). ARD...">
<meta name="twitter:image" content="/images/cover_sits_book.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/IBM_Plex_Serif-0.4.9/font.css" rel="stylesheet">
<link href="libs/IBM_Plex_Mono-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="setup.html">Setup</a></li>
<li><a class="" href="acknowledgements.html">Acknowledgements</a></li>
<li><a class="" href="introduction.html">Introduction</a></li>
<li><a class="active" href="earth-observation-data-cubes.html">Earth observation data cubes</a></li>
<li><a class="" href="operations-on-data-cubes.html">Operations on data cubes</a></li>
<li><a class="" href="working-with-time-series.html">Working with time series</a></li>
<li><a class="" href="improving-the-quality-of-training-samples.html">Improving the quality of training samples</a></li>
<li><a class="" href="machine-learning-for-data-cubes.html">Machine learning for data cubes</a></li>
<li><a class="" href="classification-of-raster-data-cubes.html">Classification of raster data cubes</a></li>
<li><a class="" href="bayesian-smoothing-for-post-processing.html">Bayesian smoothing for post-processing</a></li>
<li><a class="" href="validation-and-accuracy-measurements.html">Validation and accuracy measurements</a></li>
<li><a class="" href="uncertainty-and-active-learning.html">Uncertainty and active learning</a></li>
<li><a class="" href="ensemble-prediction-from-multiple-models.html">Ensemble prediction from multiple models</a></li>
<li><a class="" href="object-based-time-series-image-analysis.html">Object-based time series image analysis</a></li>
<li><a class="" href="data-visualisation-in-sits.html">Data visualisation in sits</a></li>
<li><a class="" href="technical-annex.html">Technical annex</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="earth-observation-data-cubes" class="section level1 unnumbered">
<h1>Earth observation data cubes<a class="anchor" aria-label="anchor" href="#earth-observation-data-cubes"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://www.kaggle.com/code/esensing/creating-data-cubes-in-sits" target="_blank"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a></p>
<div id="analysis-ready-dataard" class="section level2 unnumbered">
<h2>Analysis-ready data(ARD)<a class="anchor" aria-label="anchor" href="#analysis-ready-dataard"><i class="fas fa-link"></i></a>
</h2>
<p>Analysis Ready Data (CEOS-ARD) are satellite data that have been processed to meet the <a href="https://ceos.org/ard/">ARD standards</a> defined by the Committee on Earth Observation Satellites (CEOS). ARD data simplify and accelerate the analysis of Earth observation data by providing consistent and high-quality data that are standardized across different sensors and platforms.</p>
<p>ARD images processing includes geometric corrections, radiometric corrections, and sometimes atmospheric corrections. Images are georeferenced, meaning they are accurately aligned with a coordinate system. Optical ARD images include cloud and shadow masking information. These masks indicate which pixels affected by clouds or cloud shadows. For optical sensors, CEOS-ARD images have to be converted to surface reflectance values, which represent the fraction of light that is reflected by the surface. This makes the data more comparable across different times and locations.</p>
<p>For SAR images, CEOS-ARD specification require images to undergo Radiometric Terrain Correction (RTC) and are provided in the GammaNought (<span class="math inline">\(\gamma_0\)</span>) backscatter values. This value which mitigates the variations from diverse observation geometries and is recommended for most land applications.</p>
<p>ARD images are available from various satellite platforms, including Landsat, Sentinel, and commercial satellites. This provides a wide range of spatial, spectral, and temporal resolutions to suit different applications. They are organised as a collection of files, where each pixel contains a single value for each spectral band for a given date. These collections are available in cloud services such as Brazil Data Cube, Digital Earth Africa, and Microsoft’s Planetary Computer. In general, the timelines of the images of an ARD collection are different. Images still contain cloudy or missing pixels; bands for the images in the collection may have different resolutions. Figure <a href="earth-observation-data-cubes.html#fig:ardt">9</a> shows an example of the Landsat ARD image collection.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ardt"></span>
<img src="images/usgs_ard_tile.png" alt="ARD image collection (source: USGS. Reproduction based on fair use doctrine)." width="80%"><p class="caption">
Figure 9: ARD image collection (source: USGS. Reproduction based on fair use doctrine).
</p>
</div>
<p>ARD image collections are organized in spatial partitions. Sentinel-2/2A images follow the Military Grid Reference System (MGRS) tiling system, which divides the world into 60 UTM zones of 8 degrees of longitude. Each zone has blocks of 6 degrees of latitude. Blocks are split into tiles of 110 <span class="math inline">\(\times\)</span> 110 km<span class="math inline">\(^2\)</span> with a 10 km overlap. Figure <a href="earth-observation-data-cubes.html#fig:mgrs">10</a> shows the MGRS tiling system for a part of the Northeastern coast of Brazil, contained in UTM zone 24, block M.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mgrs"></span>
<img src="images/s2_mgrs_grid.png" alt="MGRS tiling system used by Sentinel-2 images (source: US Army. Reproduction based on fair use doctrine)." width="80%"><p class="caption">
Figure 10: MGRS tiling system used by Sentinel-2 images (source: US Army. Reproduction based on fair use doctrine).
</p>
</div>
<p>The Landsat-4/5/7/8/9 satellites use the Worldwide Reference System (WRS-2), which breaks the coverage of Landsat satellites into images identified by path and row (see Figure <a href="earth-observation-data-cubes.html#fig:wrs">11</a>). The path is the descending orbit of the satellite; the WRS-2 system has 233 paths per orbit, and each path has 119 rows, where each row refers to a latitudinal center line of a frame of imagery. Images in WRS-2 are geometrically corrected to the UTM projection.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:wrs"></span>
<img src="images/landsat_wrs_grid.png" alt="WRS-2 tiling system used by Landsat-5/7/8/9 images (source: INPE and ESRI. Reproduction based on fair use doctrine)." width="80%"><p class="caption">
Figure 11: WRS-2 tiling system used by Landsat-5/7/8/9 images (source: INPE and ESRI. Reproduction based on fair use doctrine).
</p>
</div>
</div>
<div id="image-collections-handled-by-sits" class="section level2 unnumbered">
<h2>Image collections handled by sits<a class="anchor" aria-label="anchor" href="#image-collections-handled-by-sits"><i class="fas fa-link"></i></a>
</h2>
<p>In version 1.5.1,<code>sits</code> supports access to the following ARD image cloud providers:</p>
<ul>
<li>Amazon Web Services (AWS): Open data Sentinel-2/2A level 2A collections for the Earth’s land surface.</li>
<li>Brazil Data Cube (BDC): Open data collections of Sentinel-2/2A, Landsat-8, CBERS-4/4A, and MOD13Q1 products for Brazil. These collections are organized as regular data cubes.</li>
<li>Copernicus Data Space Ecosystem (CDSE): Open data collections of Sentinel-1 RTC and Sentinel-2/2A images.</li>
<li>Digital Earth Africa (DEAFRICA): Open data collections of Sentinel-1 RTC, Sentinel-2/2A, Landsat-5/7/8/9 for Africa. Additional products available include ALOS_PALSAR mosaics, DEM_COP_30, NDVI_ANOMALY based on Landsat data, and monthly and daily rainfall data from CHIRPS.</li>
<li>Digital Earth Australia (DEAUSTRALIA): Open data ARD collections of Sentinel-2A/2B and Landsat-5/7/8/9 images; yearly geomedian of Landsat 5/7/8 images; yearly fractional land cover from 1986 to 2024.</li>
<li>Harmonized Landsat-Sentinel (HLS): HLS, provided by NASA, is an open data collection that processes Landsat 8 and Sentinel-2 imagery to a common standard.</li>
<li>Microsoft Planetary Computer (MPC): Open data collections of Sentinel-1 GRD, Sentinel-2/2A, Landsat-4/5/7/8/9 images for the Earth’s land areas. Also supported are Copernicus DEM-30 and MOD13Q1, MOD10A1 and MOD09A1 products. Sentinel-1 RTC collections are accessible but require payment.</li>
<li>Swiss Data Cube (SDC): Open data collection of Sentinel-2/2A and Landsat-8 images for Switzerland.</li>
<li>Terrascope: Cloud service with EO products which includes the ESA World Cover map.</li>
<li>USGS: Landsat-4/5/7/8/9 collections available in AWS, which require access payment.</li>
</ul>
<p>In addition, <code>sits</code> supports the use of Planet monthly mosaics stored as local files. For a detailed description of the providers and collections supported by <code>sits</code>, please run <code><a href="https://rdrr.io/pkg/sits/man/sits_list_collections.html">sits_list_collections()</a></code>.</p>
</div>
<div id="regular-image-data-cubes" class="section level2 unnumbered">
<h2>Regular image data cubes<a class="anchor" aria-label="anchor" href="#regular-image-data-cubes"><i class="fas fa-link"></i></a>
</h2>
<p>Machine learning and deep learning (ML/DL) classification algorithms require the input data to be consistent. The dimensionality of the data used for training the model has to be the same as that of the data to be classified. There should be no gaps and no missing values. Thus, to use ML/DL algorithms for remote sensing data, ARD image collections should be converted to regular data cubes. Adapting a previous definition by Appel and Pebesma <span class="citation"><a href="references.html#ref-Appel2019">[6]</a></span>, we consider a <em>regular data cube</em> has the following definition and properties:</p>
<ol style="list-style-type: decimal">
<li>A regular data cube is a four-dimensional data structure with dimensions x (longitude or easting), y (latitude or northing), time, and bands. The spatial, temporal, and attribute dimensions are independent and not interchangeable.</li>
<li>The spatial dimensions refer to a coordinate system, such as the grids defined by UTM (Universal Transverse Mercator) or MGRS (Military Grid Reference System). A grid (or tile) of the grid corresponds to a unique zone of the coordinate system. A data cube may span various tiles and UTM zones.</li>
<li>The temporal dimension is a set of continuous and equally-spaced intervals.</li>
<li>For every combination of dimensions, a cell has a single value.</li>
</ol>
<p>All cells of a data cube have the same spatiotemporal extent. The spatial resolution of each cell is the same in X and Y dimensions. All temporal intervals are the same. Each cell contains a valid set of measures. Each pixel is associated to a unique coordinate in a zone of the coordinate system. For each position in space, the data cube should provide a set of valid time series. For each time interval, the regular data cube should provide a valid 2D image (see Figure <a href="earth-observation-data-cubes.html#fig:dc">12</a>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dc"></span>
<img src="images/datacube_conception.png" alt="Conceptual view of data cubes (source: authors)." width="100%"><p class="caption">
Figure 12: Conceptual view of data cubes (source: authors).
</p>
</div>
<p>Currently, the only cloud service that provides regular data cubes by default is the Brazil Data Cube (BDC). ARD collections available in other cloud services are not regular in space and time. Bands may have different resolutions, images may not cover the entire time, and time intervals may be irregular. For this reason, subsets of these collections need to be converted to regular data cubes before further processing. To produce data cubes for machine-learning data analysis, users should first create an irregular data cube from an ARD collection and then use <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code>, as described below.</p>
</div>
<div id="creating-data-cubes" class="section level2 unnumbered">
<h2>Creating data cubes<a class="anchor" aria-label="anchor" href="#creating-data-cubes"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://www.kaggle.com/esensing/creating-data-cubes-in-sits" target="_blank"><img src="https://kaggle.com/static/images/open-in-kaggle.svg"></a></p>
<p>To obtain information on ARD image collection from cloud providers, <code>sits</code> uses the <a href="https://stacspec.org/en">SpatioTemporal Asset Catalogue</a> (STAC) protocol, a specification of geospatial information which many large image collection providers have adopted. A ‘spatiotemporal asset’ is any file that represents information about the Earth captured in a specific space and time. To access STAC endpoints, <code>sits</code> uses the <a href="http://github.com/brazil-data-cube/rstac">rstac</a> R package.</p>
<p>The function <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> supports access to image collections in cloud services; it has the following parameters:</p>
<ul>
<li>
<code>source</code>: Name of the provider.</li>
<li>
<code>collection</code>: A collection available in the provider and supported by <code>sits</code>. To find out which collections are supported by <code>sits</code>, see <code><a href="https://rdrr.io/pkg/sits/man/sits_list_collections.html">sits_list_collections()</a></code>.</li>
<li>
<code>platform</code>: Optional parameter specifying the platform in collections with multiple satellites.</li>
<li>
<code>tiles</code>: Set of tiles of image collection reference system. Either <code>tiles</code> or <code>roi</code> should be specified.</li>
<li>
<code>roi</code>: A region of interest. Either: (a) a named vector (<code>lon_min</code>, <code>lon_max</code>, <code>lat_min</code>, <code>lat_max</code>) in WGS 84 coordinates; or (b) an <code>sf</code> object. All images intersecting the convex hull of the <code>roi</code> are selected.</li>
<li>
<code>bands</code>: Optional parameter with the bands to be used. If missing, all bands from the collection are used.</li>
<li>
<code>orbit</code>: Optional parameter required only for Sentinel-1 images (default = “descending”).</li>
<li>
<code>start_date</code>: The initial date for the temporal interval containing the time series of images.</li>
<li>
<code>end_date</code>: The final date for the temporal interval containing the time series of images.</li>
</ul>
<p>The result of <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> is a tibble with a description of the selected images required for further processing. It does not contain the actual data, but only pointers to the images. The attributes of individual image files can be assessed by listing the <code>file_info</code> column of the tibble.</p>
</div>
<div id="amazon-web-services" class="section level2 unnumbered">
<h2>Amazon Web Services<a class="anchor" aria-label="anchor" href="#amazon-web-services"><i class="fas fa-link"></i></a>
</h2>
<p>Amazon Web Services (AWS) holds two kinds of collections: <em>open-data</em> and <em>requester-pays</em>. Open data collections can be accessed without cost. Requester-pays collections require payment from an AWS account. Currently, <code>sits</code> supports collection <code>SENTINEL-2-L2A</code> which is open data. The bands in 10 m resolution are B02, B03, B04, and B08. The 20 m bands are B05, B06, B07, B8A, B11, and B12. Bands B01 and B09 are available at 60 m resolution. A CLOUD band is also available. The example below shows how to access one tile of the open data <code>SENTINEL-2-L2A</code> collection. The <code>tiles</code> parameter allows selecting the desired area according to the MGRS reference system.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data cube covering an area in Brazil</span></span>
<span><span class="va">s2_23MMU_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"AWS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"23MMU"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2018-07-12"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-07-28"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_23MMU_cube</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B11"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"B02"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"B8A"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2018-10-05"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:aws"></span>
<img src="images/aws_s2.png" alt="Sentinel-2 image in an area of the Northeastern coast of Brazil (&amp;copy; EU Copernicus Sentinel Programme; source: AWS)." width="100%"><p class="caption">
Figure 13: Sentinel-2 image in an area of the Northeastern coast of Brazil (© EU Copernicus Sentinel Programme; source: AWS).
</p>
</div>
</div>
<div id="microsoft-planetary-computer" class="section level2 unnumbered">
<h2>Microsoft Planetary Computer<a class="anchor" aria-label="anchor" href="#microsoft-planetary-computer"><i class="fas fa-link"></i></a>
</h2>
<p>The <code>sits</code> supports access to three open data collection from Microsoft’s Planetary Computer (MPC): <code>SENTINEL-1-GRD</code>, <code>SENTINEL-2-L2A</code>, <code>LANDSAT-C2-L2</code>. It also allows access to <code>COP-DEM-GLO-30</code> (Copernicus Global DEM at 30 meter resolution) and <code>MOD13Q1-6.1</code>(version 6.1 of the MODIS MOD13Q1 product). Access to the non-open data collection <code>SENTINEL-1-RTC</code> is available for users that have registration in MPC.</p>
<div id="sentinel-22a-images-in-mpc" class="section level3 unnumbered">
<h3>SENTINEL-2/2A images in MPC<a class="anchor" aria-label="anchor" href="#sentinel-22a-images-in-mpc"><i class="fas fa-link"></i></a>
</h3>
<p>The SENTINEL-2/2A ARD images available in MPC have the same bands and resolutions as those available in AWS (see above). The example below shows how to access the <code>SENTINEL-2-L2A</code> collection.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data cube covering an area in the Brazilian Amazon</span></span>
<span><span class="va">s2_20LKP_cube_MPC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"20LKP"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2019-07-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-07-28"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot a color composite of one date of the cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_20LKP_cube_MPC</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B11"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2019-07-18"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mpc1"></span>
<img src="images/mpc_s2.png" alt="Sentinel-2 image in an area of the state of Rondonia, Brazil (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft)." width="100%"><p class="caption">
Figure 14: Sentinel-2 image in an area of the state of Rondonia, Brazil (© EU Copernicus Sentinel Programme; source: Microsoft).
</p>
</div>
</div>
<div id="landsat-c2-l2-images-in-mpc" class="section level3 unnumbered">
<h3>LANDSAT-C2-L2 images in MPC<a class="anchor" aria-label="anchor" href="#landsat-c2-l2-images-in-mpc"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>LANDSAT-C2-L2</code> collection provides access to data from Landsat-4/5/7/8/9 satellites. Images from these satellites have been intercalibrated to ensure data consistency. For compatibility between the different Landsat sensors, the band names are BLUE, GREEN, RED, NIR08, SWIR16, and SWIR22. All images have 30 m resolution. For this collection, tile search is not supported; the <code>roi</code> parameter should be used. The example below shows how to retrieve data from a region of interest covering the city of Brasilia in Brazil.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Read a ROI that covers part of the Northeastern coast of Brazil</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  lon_min <span class="op">=</span> <span class="op">-</span><span class="fl">43.5526</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">2.9644</span>,</span>
<span>  lon_max <span class="op">=</span> <span class="op">-</span><span class="fl">42.5124</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">2.1671</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Select the cube</span></span>
<span><span class="va">s2_L8_cube_MPC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"LANDSAT-C2-L2"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"RED"</span>, <span class="st">"GREEN"</span>, <span class="st">"NIR08"</span>, <span class="st">"SWIR16"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">roi</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2019-06-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-09-01"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the tile that covers the Lencois Maranhenses</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_L8_cube_MPC</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"RED"</span>, green <span class="op">=</span> <span class="st">"GREEN"</span>, blue <span class="op">=</span> <span class="st">"BLUE"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2019-06-30"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mpc2"></span>
<img src="images/mpc_l8.png" alt="Landsat-8 image in an area in Northeast Brazil (sources: USGS and Microsoft)." width="100%"><p class="caption">
Figure 15: Landsat-8 image in an area in Northeast Brazil (sources: USGS and Microsoft).
</p>
</div>
</div>
<div id="sentinel-1-grd-images-in-mpc" class="section level3 unnumbered">
<h3>SENTINEL-1-GRD images in MPC<a class="anchor" aria-label="anchor" href="#sentinel-1-grd-images-in-mpc"><i class="fas fa-link"></i></a>
</h3>
<p>Sentinel-1 GRD products consist of focused SAR data that has been detected, multi-looked and projected to ground range using the WGS84 Earth ellipsoid model. GRD images are subject for variations in the radar signal’s intensity due to topographic effects, antenna pattern, range spreading loss, and other radiometric distortions. The most common types of distortions include foreshortening, layover and shadowing.</p>
<p>Foreshortening occurs when the radar signal strikes a steep terrain slope facing the radar, causing the slope to appear compressed in the image. Features like mountains can appear much steeper than they are, and their true heights can be difficult to interpret. Layover happens when the radar signal reaches the top of a tall feature (like a mountain or building) before it reaches the base. As a result, the top of the feature is displaced towards the radar and appears in front of its base. This results in a reversal of the order of features along the radar line-of-sight, making the image interpretation challenging. Shadowing occurs when a radar signal is obstructed by a tall object, casting a shadow on the area behind it that the radar cannot illuminate. The shadowed areas appear dark in SAR images, and no information is available from these regions, similar to optical shadows.</p>
<p>Access to Sentinel-1 GRD images can be done either by MGRS tiles (<code>tiles</code>) or by region of interest (<code>roi</code>). We recommend using the MGRS tiling system for specifying the area of interest, since when these images are regularized, they will be re-projected into MGRS tiles. By default, only images in descending orbit are selected.</p>
<p>The following example shows how to create a data cube of S1 GRD images over a region in Mato Grosso Brazil that is an area of the Amazon forest that has been deforested. The resulting cube will not follow any specific projection and its coordinates will be stated as EPSG 4326 (latitude/longitude). Its geometry is derived from the SAR slant-range perspective; thus, it will appear included in relation to the Earth’s longitude.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cube_s1_grd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-1-GRD"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VV"</span><span class="op">)</span>,</span>
<span>  orbit <span class="op">=</span> <span class="st">"descending"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"21LUJ"</span>, <span class="st">"21LVJ"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-08-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-09-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s1_grd</span>, band <span class="op">=</span> <span class="st">"VV"</span>, palette <span class="op">=</span> <span class="st">"Greys"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mpc3"></span>
<img src="images/mpc3.png" alt="Sentinel-1 image in an area in Mato Grosso, Brazil (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft)." width="100%"><p class="caption">
Figure 16: Sentinel-1 image in an area in Mato Grosso, Brazil (© EU Copernicus Sentinel Programme; source: Microsoft).
</p>
</div>
<p>As explained earlier in this chapter, in areas with areas with large elevation differences, Sentinel-1 GRD images will have geometric distortions. For this reason, whenever possible, we recommend the use of RTC (radiometrically terrain corrected) images as described in the next session.</p>
</div>
<div id="sentinel-1-rtc-images-in-mpc" class="section level3 unnumbered">
<h3>SENTINEL-1-RTC images in MPC<a class="anchor" aria-label="anchor" href="#sentinel-1-rtc-images-in-mpc"><i class="fas fa-link"></i></a>
</h3>
<p>An RTC SAR image has undergone corrections for both geometric distortions and radiometric distortions caused by the terrain. The purpose of RTC processing is to enhance the interpretability and usability of SAR images for various applications by providing a more accurate representation of the Earth’s surface. The radar backscatter values are normalized to account for these variations, ensuring that the image accurately represents the reflectivity of the surface features.</p>
<p>The terrain correction addresses geometric distortions caused by the side-looking geometry of SAR imaging, such as foreshortening, layover, and shadowing. It uses a Digital Elevation Model (DEM) to model the terrain and re-project the SAR image from the slant range (radar line-of-sight) to the ground range (true geographic coordinates). This process aligns the SAR image with the actual topography, providing a more accurate spatial representation.</p>
<p>In MPC, access to Sentinel-1-RTC images requires a Planetary Computer account. User will receive a Shared Access Signature (SAS) Token from MPC that allows access to RTC data. Once a user receives a token from Microsoft, she needs to include the environment variable <code>MPC_TOKEN</code> in her <code>.Rprofile</code>. Therefore, the following example only works for users that have an SAS token.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cube_s1_rtc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-1-RTC"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VV"</span>, <span class="st">"VH"</span><span class="op">)</span>,</span>
<span>  orbit <span class="op">=</span> <span class="st">"descending"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"18NZM"</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-08-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-09-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s1_rtc</span>, band <span class="op">=</span> <span class="st">"VV"</span>, palette <span class="op">=</span> <span class="st">"Greys"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mpcrtcol"></span>
<img src="images/mpcrtcol.png" alt="Sentinel-1-RTC image of an area in Colombia (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft)." width="100%"><p class="caption">
Figure 17: Sentinel-1-RTC image of an area in Colombia (© EU Copernicus Sentinel Programme; source: Microsoft).
</p>
</div>
<p>The above image is from the central region of Colombia, a country with large variations in altitude due to the Andes mountains. Users are invited to compare this images with the one from the <code>SENTINEL-1-GRD</code> collection and see the significant geometrical distortions of the GRD image compared with the RTC one.</p>
</div>
<div id="copernicus-dem-30-meter-images-in-mpc" class="section level3 unnumbered">
<h3>Copernicus DEM 30 meter images in MPC<a class="anchor" aria-label="anchor" href="#copernicus-dem-30-meter-images-in-mpc"><i class="fas fa-link"></i></a>
</h3>
<p>The Copernicus digital elevation model 30-meter global dataset (COP-DEM-GLO-30) is a high-resolution topographic data product provided by the European Space Agency (ESA) under the Copernicus Program. The vertical accuracy of the Copernicus DEM 30-meter dataset is typically within a few meters, but this can vary depending on the region and the original data sources. The primary data source for the Copernicus DEM is data from the TanDEM-X mission, designed by the German Aerospace Center (DLR). TanDEM-X provides high-resolution radar data through interferometric synthetic aperture radar (InSAR) techniques.</p>
<p>The Copernicus DEM 30 meter is organized in a 1<span class="math inline">\(^\circ\)</span> by 1<span class="math inline">\(^\circ\)</span> grid. In <code>sits</code>, access to COP-DEM-GLO-30 images can be done either by MGRS tiles (<code>tiles</code>) or by region of interest (<code>roi</code>). In both case, the cube is retrieved based on the parts of the grid that intersect the region of interest or the chosen tiles.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cube_dem_30</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"COP-DEM-GLO-30"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"20LMR"</span>,</span>
<span>  band <span class="op">=</span> <span class="st">"ELEVATION"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_dem_30</span>, band <span class="op">=</span> <span class="st">"ELEVATION"</span>, palette <span class="op">=</span> <span class="st">"RdYlGn"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mpc4"></span>
<img src="images/mpc4.png" alt="Copernicus 30-meter DEM of an area in Brazil (&amp;copy; DLR e.V. 2010-2014 and &amp;copy Airbus Defence and Space GmbH 2014-2018 provided under COPERNICUS by the European Union and ESA; source: Microsoft)." width="100%"><p class="caption">
Figure 18: Copernicus 30-meter DEM of an area in Brazil (© DLR e.V. 2010-2014 and &amp;copy Airbus Defence and Space GmbH 2014-2018 provided under COPERNICUS by the European Union and ESA; source: Microsoft).
</p>
</div>
</div>
</div>
<div id="brazil-data-cube" class="section level2 unnumbered">
<h2>Brazil Data Cube<a class="anchor" aria-label="anchor" href="#brazil-data-cube"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="http://brazildatacube.org/en">Brazil Data Cube</a> (BDC) is built by Brazil’s National Institute for Space Research (INPE), to provide regular EO data cubes from CBERS, LANDSAT, SENTINEL-2, and TERRA/MODIS satellites for environmental applications. The collections available in the BDC are: <code>LANDSAT-OLI-16D</code> (Landsat-8 OLI, 30 m resolution, 16-day intervals), <code>SENTINEL-2-16D</code> (Sentinel-2A and 2B MSI images at 10 m resolution, 16-day intervals), <code>CBERS-WFI-16D</code> (CBERS 4 WFI, 64 m resolution, 16-day intervals), <code>CBERS-WFI-8D</code>(CBERS 4 and 4A WFI images, 64m resolution, 8-day intervals), and <code>MOD13Q1-6.1</code> (MODIS MOD13SQ1 product, collection 6, 250 m resolution, 16-day intervals). For more details, use <code>sits_list_collections(source = "BDC")</code>.</p>
<p>The BDC uses three hierarchical grids based on the Albers Equal Area projection and SIRGAS 2000 datum. The large grid has tiles of 4224.4 <span class="math inline">\(\times4\)</span> 224.4 km<sup>2</sup> and is used for CBERS-4 AWFI collections at 64 m resolution; each CBERS-4 AWFI tile contains images of 6600 <span class="math inline">\(\times\)</span> 6600 pixels. The medium grid is used for Landsat-8 OLI collections at 30 m resolution; tiles have an extension of 211.2 <span class="math inline">\(\times\)</span> 211.2 km<sup>2</sup>, and each image has 7040 <span class="math inline">\(\times\)</span> 7040 pixels. The small grid covers 105.6 <span class="math inline">\(\times\)</span> 105.6 km<sup>2</sup> and is used for Sentinel-2 MSI collections at 10 m resolutions; each image has 10560 <span class="math inline">\(\times\)</span> 10560 pixels. The data cubes in the BDC are regularly spaced in time and cloud-corrected <span class="citation"><a href="references.html#ref-Ferreira2020a">[7]</a></span>.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bdc"></span>
<img src="images/bdc_grid.png" alt="Hierarchical BDC tiling system showing (a) large BDC grid overlayed on Brazilian biomes, (b) one large tile, (c) four medium tiles, and (d) sixteen small tiles (Source: Ferreira et al. (2020). Reproduction under fair use doctrine)." width="80%"><p class="caption">
Figure 19: Hierarchical BDC tiling system showing (a) large BDC grid overlayed on Brazilian biomes, (b) one large tile, (c) four medium tiles, and (d) sixteen small tiles (Source: Ferreira et al. (2020). Reproduction under fair use doctrine).
</p>
</div>
<p>To access the BDC, users must provide their credentials using environment variables, as shown below. Obtaining a BDC access key is free. Users must register at the <a href="https://brazildatacube.dpi.inpe.br/portal/explore">BDC site</a> to obtain a key. In the example below, the data cube is defined as one tile (“005004”) of <code>CBERS-WFI-16D</code> collection, which holds CBERS AWFI images at 16 days resolution.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a tile from the CBERS-4/4A AWFI collection</span></span>
<span><span class="va">cbers_tile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"BDC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"CBERS-WFI-16D"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"005004"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B13"</span>, <span class="st">"B14"</span>, <span class="st">"B15"</span>, <span class="st">"B16"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-05-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-09-01"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot one time instance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cbers_tile</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B15"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"B16"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"B13"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2021-05-09"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cbers"></span>
<img src="images/bdc_cbers4.png" alt="CBERS-4 WFI image in a Cerrado area in Brazil (&amp;copy; INPE/Brazil licensed under CC-BY-SA. source: Brazil Data Cube)." width="100%"><p class="caption">
Figure 20: CBERS-4 WFI image in a Cerrado area in Brazil (© INPE/Brazil licensed under CC-BY-SA. source: Brazil Data Cube).
</p>
</div>
</div>
<div id="copernicus-data-space-ecosystem-cdse" class="section level2 unnumbered">
<h2>Copernicus Data Space Ecosystem (CDSE)<a class="anchor" aria-label="anchor" href="#copernicus-data-space-ecosystem-cdse"><i class="fas fa-link"></i></a>
</h2>
<p>The Copernicus Data Space Ecosystem (CDSE) is a cloud service designed to support access to Earth observation data from the Copernicus Sentinel missions and other sources. It is designed and maintained by the European Space Agency (ESA) with support from the European Commission.</p>
<p>Configuring user access to CDSE involves several steps to ensure proper registration, access to data, and utilization of the platform’s tools and services. Visit the Copernicus Data Space Ecosystem <a href="https://dataspace.copernicus.eu">registration page</a>. Complete the registration form with your details, including name, email address, organization, and sector. Confirm your email address through the verification link sent to your inbox.</p>
<p>After registration, you will need to obtain access credentials to the S3 service implemented by CDSE, which can be obtained using the <a href="https://eodata-s3keysmanager.dataspace.copernicus.eu/panel/s3-credentials">CSDE S3 credentials site</a>. The site will request you to add a new credential. You will receive two keys: an an S3 access key and a secret access key. Take note of both and include the following lines in your <code>.Rprofile</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="earth-observation-data-cubes.html#cb50-1" tabindex="-1"></a><span class="fu">Sys.setenv</span>(</span>
<span id="cb50-2"><a href="earth-observation-data-cubes.html#cb50-2" tabindex="-1"></a>    <span class="at">AWS_ACCESS_KEY_ID =</span> <span class="st">"your access key"</span>,</span>
<span id="cb50-3"><a href="earth-observation-data-cubes.html#cb50-3" tabindex="-1"></a>    <span class="at">AWS_SECRET_ACCESS_KEY =</span> <span class="st">"your secret access key"</span></span>
<span id="cb50-4"><a href="earth-observation-data-cubes.html#cb50-4" tabindex="-1"></a>      <span class="at">AWS_S3_ENDPOINT =</span> <span class="st">"eodata.dataspace.copernicus.eu"</span>,</span>
<span id="cb50-5"><a href="earth-observation-data-cubes.html#cb50-5" tabindex="-1"></a>      <span class="at">AWS_VIRTUAL_HOSTING =</span> <span class="st">"FALSE"</span></span>
<span id="cb50-6"><a href="earth-observation-data-cubes.html#cb50-6" tabindex="-1"></a>)</span></code></pre></div>
<p>After including these lines in your .Rprofile, restart <code>R</code> for the changes to take effect. By following these steps, users will have access to the Copernicus Data Space Ecosystem.</p>
<div id="sentinel-22a-images-in-cdse" class="section level3 unnumbered">
<h3>SENTINEL-2/2A images in CDSE<a class="anchor" aria-label="anchor" href="#sentinel-22a-images-in-cdse"><i class="fas fa-link"></i></a>
</h3>
<p>CDSE hosts a global collection of Sentinel-2 Level-2A images, which are processed according to the <a href="https://ceos.org/ard/">CEOS Analysis-Ready Data</a> specifications. One example is provided below, where we present a Sentinel-2 image of the Lena river delta in Siberia in summertime.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># obtain a collection of images of a tile covering part of Lena delta</span></span>
<span><span class="va">lena_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"CDSE"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B04"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"B12"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2023-05-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2023-09-01"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"52XDF"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot an image from summertime</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lena_cube</span>, date <span class="op">=</span> <span class="st">"2023-07-06"</span>, red <span class="op">=</span> <span class="st">"B12"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B04"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:lena"></span>
<img src="images/s2_lena_delta.png" alt="Sentinel-2 image of the Lena river delta in summertime (&amp;copy; EU Copernicus Sentinel Programme; source: CDSE)." width="100%"><p class="caption">
Figure 21: Sentinel-2 image of the Lena river delta in summertime (© EU Copernicus Sentinel Programme; source: CDSE).
</p>
</div>
</div>
<div id="sentinel-1-rtc-images-in-cdse" class="section level3 unnumbered">
<h3>SENTINEL-1-RTC images in CDSE<a class="anchor" aria-label="anchor" href="#sentinel-1-rtc-images-in-cdse"><i class="fas fa-link"></i></a>
</h3>
<p>An important product under development at CDSE are the radiometric terrain corrected (RTC) Sentinel-1 images. in CDSE, this product is referred to as normalized terrain backscater (NRB). The S1-NRB product contains radiometrically terrain corrected (RTC) gamma nought backscatter (γ0) processed from Single Look Complex (SLC) Level-1A data. Each acquired polarization is stored in an individual binary image file.</p>
<p>All images are projected and gridded into the United States Military Grid Reference System (US-MGRS). The use of the US-MGRS tile grid ensures a very high level of interoperability with Sentinel-2 Level-2A ARD products making it easy to also set-up complex analysis systems that exploit both SAR and optical data. While speckle is inherent in SAR acquisitions, speckle filtering is not applied to the S1-NRB product in order to preserve spatial resolution. Some applications (or processing methods) may require spatial or temporal filtering for stationary backscatter estimates.</p>
<p>For more details, please refer to the <a href="https://sentinels.copernicus.eu/web/sentinel/sentinel-1-ard-normalised-radar-backscatter-nrb-product">S1-NRB product website</a>. As of July 2024, RTC images are only available for Africa. Global coverage is expected to grow as ESA expands the S1-RTC archive. The following example shows an S1-RTC image for the Rift valley in Ethiopia.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve a S1-RTC cube and plot</span></span>
<span><span class="va">s1_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"CDSE"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-1-RTC"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VV"</span>, <span class="st">"VH"</span><span class="op">)</span>,</span>
<span>  orbit <span class="op">=</span> <span class="st">"descending"</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2023-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2023-12-31"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"37NCH"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s1_cube</span>, band <span class="op">=</span> <span class="st">"VV"</span>, date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2023-03-03"</span><span class="op">)</span>, palette <span class="op">=</span> <span class="st">"Greys"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:cdsertc"></span>
<img src="images/s1_rtc_cdse.png" alt="Sentinel-1-RTC image of the Rift Valley in Ethiopia (&amp;copy; EU Copernicus Sentinel Programme; source: CDSE)." width="100%"><p class="caption">
Figure 22: Sentinel-1-RTC image of the Rift Valley in Ethiopia (© EU Copernicus Sentinel Programme; source: CDSE).
</p>
</div>
</div>
</div>
<div id="digital-earth-africa" class="section level2 unnumbered">
<h2>Digital Earth Africa<a class="anchor" aria-label="anchor" href="#digital-earth-africa"><i class="fas fa-link"></i></a>
</h2>
<p>Digital Earth Africa (DEAFRICA) is a cloud service that provides open-access Earth observation data for the African continent. The ARD image collections in <code>sits</code> are:</p>
<ul>
<li>Sentinel-2 level 2A (<code>SENTINEL-2-L2A</code>), organised as MGRS tiles.</li>
<li>Sentinel-1 radiometrically terrain corrected (<code>SENTINEL-1-RTC</code>)</li>
<li>Landsat-5 (<code>LS5-SR</code>), Landsat-7 (<code>LS7-SR</code>), Landsat-8 (<code>LS8-SR</code>) and Landat-9 (<code>LS9-SR</code>). All Landsat collections are ARD data and are organized as WRS-2 tiles.</li>
<li>SAR L-band images produced by PALSAR sensor onboard the Japanese ALOS satellite(<code>ALOS-PALSAR-MOSAIC</code>). Data is organized in a 5<span class="math inline">\(^\circ\)</span> by 5<span class="math inline">\(^\circ\)</span> grid with a spatial resolution of 25 meters. Images are available annually from 2007 to 2010 (ALOS/PALSAR) and from 2015 to 2022 (ALOS-2/PALSAR-2).</li>
<li>Estimates of vegetation condition using NDVI anomalies (<code>NDVI-ANOMALY</code>) compared with the long-term baseline condition. The available measurements are “NDVI_MEAN” (mean NDVI for a month) and “NDVI-STD-ANOMALY” (standardised NDVI anomaly for a month).</li>
<li>Rainfall information provided by Climate Hazards Group InfraRed Precipitation with Station data (CHIRPS) from University of California in Santa Barbara. There are monthly (<code>RAINFALL-CHIRPS-MONTHLY</code>) and daily (<code>RAINFALL-CHIRPS-DAILY</code>) products over Africa.</li>
<li>Digital elevation model provided by the EC Copernicus program (<code>COP-DEM-30</code>) in 30 meter resolution organized in a 1<span class="math inline">\(^\circ\)</span> by 1<span class="math inline">\(^\circ\)</span> grid.</li>
<li>Annual geomedian images for Landsat 8 and Landsat 9 (<code>GM-LS8-LS9-ANNUAL</code> (LANDSAT/OLI)`) in grid system WRS-2.</li>
<li>Annual geomedian images for Sentinel-2 (<code>GM-S2-ANNUAL</code>) in MGRS grid.</li>
<li>Rolling three-month geomedian images for Sentinel-2 (<code>GM-S2-ROLLING</code>) in MGRS grid.</li>
<li>Semestral geomedian images for Sentinel-2 (<code>GM-S2-SEMIANNUAL</code>) in MGRS grid.</li>
</ul>
<p>Access to DEAFRICA Sentinel-2 images can be done wither using <code>tiles</code> or <code>roi</code> parameter. In this example, the requested <code>roi</code> produces a cube that contains one MGRS tiles (“35LPH”) covering an area of Madagascar that includes the Betsiboka Estuary.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dea_s2_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"DEAFRICA"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  roi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    lon_min <span class="op">=</span> <span class="fl">46.1</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">15.6</span>,</span>
<span>    lon_max <span class="op">=</span> <span class="fl">46.6</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">16.1</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B04"</span>, <span class="st">"B08"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2019-04-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2019-05-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dea_s2_cube</span>, red <span class="op">=</span> <span class="st">"B04"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>, green <span class="op">=</span> <span class="st">"B08"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dea1"></span>
<img src="images/deafrica_s2.png" alt="Sentinel-2 image in an area over Madagascar (&amp;copy; EU Copernicus Sentinel Programme; source: Digital Earth Africa)." width="100%"><p class="caption">
Figure 23: Sentinel-2 image in an area over Madagascar (© EU Copernicus Sentinel Programme; source: Digital Earth Africa).
</p>
</div>
<p>The next example retrieves a set of ARD Landsat-9 data, covering the Serengeti plain in Tanzania.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dea_l9_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"DEAFRICA"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"LS9-SR"</span>,</span>
<span>  roi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    lon_min <span class="op">=</span> <span class="fl">33.0</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">3.60</span>,</span>
<span>    lon_max <span class="op">=</span> <span class="fl">33.6</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">3.00</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B04"</span>, <span class="st">"B05"</span>, <span class="st">"B06"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2023-05-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2023-08-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dea_l9_cube</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2023-06-26"</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"B06"</span>, green <span class="op">=</span> <span class="st">"B05"</span>, blue <span class="op">=</span> <span class="st">"B04"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:seren"></span>
<img src="images/landsat9_serengeti.png" alt="Landsat-9 image in an area over the Serengeti in Tanzania (source: Digital Earth Africa)." width="100%"><p class="caption">
Figure 24: Landsat-9 image in an area over the Serengeti in Tanzania (source: Digital Earth Africa).
</p>
</div>
<p>The following example shows how to retrieve a subset of the ALOS-PALSAR mosaic for year 2020, for an area near the border between Congo and Rwanda.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dea_alos_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"DEAFRICA"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"ALOS-PALSAR-MOSAIC"</span>,</span>
<span>  roi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    lon_min <span class="op">=</span> <span class="fl">28.69</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">2.35</span>,</span>
<span>    lon_max <span class="op">=</span> <span class="fl">29.35</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">1.56</span></span>
<span>  <span class="op">)</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"HH"</span>, <span class="st">"HV"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2020-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2020-12-31"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dea_alos_cube</span>, band <span class="op">=</span> <span class="st">"HH"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:lakekivu"></span>
<img src="images/alos_palsar_hh_lake_kivu.png" alt="ALOS-PALSAC mosaic in the Congo forest area (&amp;copy; JAXA EORC; source: Digital Earth Africa)." width="100%"><p class="caption">
Figure 25: ALOS-PALSAC mosaic in the Congo forest area (© JAXA EORC; source: Digital Earth Africa).
</p>
</div>
</div>
<div id="digital-earth-australia" class="section level2 unnumbered">
<h2>Digital Earth Australia<a class="anchor" aria-label="anchor" href="#digital-earth-australia"><i class="fas fa-link"></i></a>
</h2>
<p>Digital Earth Australia (DEAUSTRALIA) is an initiative by Geoscience Australia that uses satellite data to monitor and analyze environmental changes and resources across the Australian continent. It provides many datasets that offer detailed information on phenomena such as droughts, agriculture, water availability, floods, coastal erosion, and urban development. The DEAUSTRALIA image collections in <code>sits</code> are:</p>
<ul>
<li>GA_LS5T_ARD_3: ARD images from Landsat-5 satellite, with bands “BLUE”, “GREEN”, “RED”, “NIR”, “SWIR-1”, “SWIR-2”, and “CLOUD”.</li>
<li>GA_LS7E_ARD_3: ARD images from Landsat-7 satellite, with the same bands as Landsat-5.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>GA_LS8C_ARD_3: ARD images from Landsat-8 satellite, with bands “COASTAL-AEROSOL”, “BLUE”, “GREEN”, “RED”, “NIR”, “SWIR-1”, “SWIR-2”, “PANCHROMATIC”, and “CLOUD”.</li>
</ol>
<ul>
<li>GA_LS9C_ARD_3: ARD images from Landsat-9 satellite, with the same bands as Landsat-8.</li>
<li>GA_S2AM_ARD_3: ARD images from Sentinel-2A satellite, with bands “COASTAL-AEROSOL”, “BLUE”, “GREEN”, “RED”, “RED-EDGE-1”, “RED-EDGE-2”, “RED-EDGE-3”, “NIR-1”, “NIR-2”, “SWIR-2”, “SWIR-3”, and “CLOUD”.</li>
<li>GA_S2BM_ARD_3: ARD images from Sentinel-2B satellite, with the same bands as Sentinel-2A.</li>
<li>GA_LS5T_GM_CYEAR_3: Landsat-5 geomedian images, with bands “BLUE”, “GREEN”, “RED”, “NIR”, “SWIR1”, “SWIR2”, “EDEV”, “SDEV”, “BCDEV”.</li>
<li>GA_LS7E_GM_CYEAR_3: Landsat-7 geomedian images, with the same bands as Landsat-5 geomedian.</li>
<li>GA_LS8CLS9C_GM_CYEAR_3: Landsat-8/9 geomedian images, with the same bands as Landsat-5 geomedian.</li>
<li>GA_LS_FC_3: Landsat fractional land cover, with bands “BS”, “PV”, “NPV”.</li>
<li>GA_S2LS_INTERTIDAL_CYEAR_3: Landsat/Sentinel intertidal data, with bands “ELEVATION”, “ELEVATION-UNCERTAINTY”, “EXPOSURE”, “TA-HAT”, “TA-HOT”, “TA-LOT”, “TA-LAT” “TA-OFFSET-HIGH”, “TA-OFFSET-LOW”, “TA-SPREAD”, “QA-NDWI-CORR”and “QA-NDWI-FREQ”.</li>
</ul>
<p>The following code retrieves an image from Sentinel-2</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get roi for an MGRS tile</span></span>
<span><span class="va">bbox_55KGR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_mgrs_to_roi.html">sits_mgrs_to_roi</a></span><span class="op">(</span><span class="st">"55KGR"</span><span class="op">)</span></span>
<span><span class="co"># retrieve the world cover map for the chosen roi</span></span>
<span><span class="va">s2_56KKV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"DEAUSTRALIA"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"GA_S2AM_ARD_3"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"56KKV"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"GREEN"</span>, <span class="st">"RED"</span>, <span class="st">"NIR-2"</span>, <span class="st">"SWIR-2"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2023-09-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2023-11-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot the resulting map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_56KKV</span>, green <span class="op">=</span> <span class="st">"NIR-2"</span>, blue <span class="op">=</span> <span class="st">"BLUE"</span>, red <span class="op">=</span> <span class="st">"SWIR-2"</span>, date <span class="op">=</span> <span class="st">"2023-10-14"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:goldcoast"></span>
<img src="images/s2_56KKV.png" alt="Plot of Sentinel-2 image obtained from the DEAUSTRALIA collection for date 2023-10-14 showing MGRS tile 56KKV (&amp;copy; EU Copernicus Sentinel Programme; source: Digital Earth Australia)." width="100%"><p class="caption">
Figure 26: Plot of Sentinel-2 image obtained from the DEAUSTRALIA collection for date 2023-10-14 showing MGRS tile 56KKV (© EU Copernicus Sentinel Programme; source: Digital Earth Australia).
</p>
</div>
</div>
<div id="harmonized-landsat-sentinel" class="section level2 unnumbered">
<h2>Harmonized Landsat-Sentinel<a class="anchor" aria-label="anchor" href="#harmonized-landsat-sentinel"><i class="fas fa-link"></i></a>
</h2>
<p>Harmonized Landsat Sentinel (HLS) is a NASA initiative that processes and harmonizes Landsat 8 and Sentinel-2 imagery to a common standard, including atmospheric correction, alignment, resampling, and corrections for BRDF (bidirectional reflectance distribution function). The purpose of the HLS project is to create a unified and consistent dataset that integrates the advantages of both systems, making it easier to work with the data.</p>
<p>The NASA Harmonized Landsat and Sentinel (HLS) service provides two image collections:</p>
<ul>
<li><p>Landsat 8 OLI Surface Reflectance HLS (HLSL30) – The HLSL30 product includes atmospherically corrected surface reflectance from the Landsat 8 OLI sensors at 30 m resolution. The dataset includes 11 spectral bands.</p></li>
<li><p>Sentinel-2 MultiSpectral Instrument Surface Reflectance HLS (HLSS30) – The HLSS30 product includes atmospherically corrected surface reflectance from the Sentinel-2 MSI sensors at 30 m resolution. The dataset includes 12 spectral bands.</p></li>
</ul>
<p>The HLS tiling system is identical as the one used for Sentinel-2 (MGRS). The tiles dimension is 109.8 km and there is an overlap of 4,900 m on each side.</p>
<p>To access NASA HLS, users need to registed at <a href="https://urs.earthdata.nasa.gov/">NASA EarthData</a>, and save their login and password in a ~/.netrc plain text file in Unix (or %HOME%_netrc in Windows). The file must contain the following fields:</p>
<pre class="echo"><code>machine urs.earthdata.nasa.gov
login &lt;username&gt;
password &lt;password&gt;</code></pre>
<p>We recommend using the earthdatalogin package to create a <code>.netrc</code> file with the <code>earthdatalogin::edl_netrc</code>. This function creates a properly configured .netrc file in the user’s home directory and an environment variable GDAL_HTTP_NETRC_FILE, as shown in the example.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://boettiger-lab.github.io/earthdatalogin/">earthdatalogin</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">earthdatalogin</span><span class="fu">::</span><span class="fu">edl_netrc</span><span class="op">(</span></span>
<span>  username <span class="op">=</span> <span class="st">"&lt;your user name&gt;"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"&lt;your password&gt;"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Access to images in NASA HLS is done by region of interest or by tiles. The following example shows an HLS Sentinel-2 image over the Brazilian coast.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a region of interest</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  lon_min <span class="op">=</span> <span class="op">-</span><span class="fl">45.6422</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">24.0335</span>,</span>
<span>  lon_max <span class="op">=</span> <span class="op">-</span><span class="fl">45.0840</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">23.6178</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a cube from the HLSS30 collection</span></span>
<span><span class="va">hls_cube_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"HLS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"HLSS30"</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">roi</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"GREEN"</span>, <span class="st">"RED"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-09-01"</span><span class="op">)</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot the cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hls_cube_s2</span>, red <span class="op">=</span> <span class="st">"RED"</span>, green <span class="op">=</span> <span class="st">"GREEN"</span>, blue <span class="op">=</span> <span class="st">"BLUE"</span>, date <span class="op">=</span> <span class="st">"2020-06-20"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:hlssen"></span>
<img src="images/hls_ilhabela_s2.png" alt="Plot of Sentinel-2 image obtained from the NASA HLS collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast  (&amp;copy;EU Copernicus Sentinel Programme; source: NASA)." width="100%"><p class="caption">
Figure 27: Plot of Sentinel-2 image obtained from the NASA HLS collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast (©EU Copernicus Sentinel Programme; source: NASA).
</p>
</div>
<p>Images from the HLS Landsat and Sentinel-2 collections are accessed separately and can be combined with <code><a href="https://rdrr.io/pkg/sits/man/sits_merge.html">sits_merge()</a></code>. The script below creates an HLS Landsat cube over the same area as the Sentinel-2 cube above bands. The two cubes are then merged.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a region of interest</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  lon_min <span class="op">=</span> <span class="op">-</span><span class="fl">45.6422</span>, lat_min <span class="op">=</span> <span class="op">-</span><span class="fl">24.0335</span>,</span>
<span>  lon_max <span class="op">=</span> <span class="op">-</span><span class="fl">45.0840</span>, lat_max <span class="op">=</span> <span class="op">-</span><span class="fl">23.6178</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create a cube from the HLSS30 collection</span></span>
<span><span class="va">hls_cube_l8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"HLS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"HLSL30"</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">roi</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUE"</span>, <span class="st">"GREEN"</span>, <span class="st">"RED"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-06-01"</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2020-09-01"</span><span class="op">)</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># merge the Sentinel-2 and Landsat-8 cubes</span></span>
<span><span class="va">hls_cube_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_merge.html">sits_merge</a></span><span class="op">(</span><span class="va">hls_cube_s2</span>, <span class="va">hls_cube_l8</span><span class="op">)</span></span></code></pre></div>
<p>Comparing the timelines of the original cubes and the merged one, one can see the benefits of the merged collection for time series data analysis.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeline of the Sentinel-2 cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">hls_cube_s2</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;  [1] "2020-06-15" "2020-06-20" "2020-06-25" "2020-06-30" "2020-07-05"
#&gt;  [6] "2020-07-10" "2020-07-20" "2020-07-25" "2020-08-04" "2020-08-09"
#&gt; [11] "2020-08-14" "2020-08-19" "2020-08-24" "2020-08-29"</code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeline of the Landsat-8 cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">hls_cube_l8</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; [1] "2020-06-09" "2020-06-25" "2020-07-11" "2020-07-27" "2020-08-12"
#&gt; [6] "2020-08-28"</code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Timeline of the Landsat-8 cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">hls_cube_merged</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt;  [1] "2020-06-09" "2020-06-15" "2020-06-20" "2020-06-25" "2020-06-30"
#&gt;  [6] "2020-07-05" "2020-07-10" "2020-07-11" "2020-07-20" "2020-07-25"
#&gt; [11] "2020-07-27" "2020-08-04" "2020-08-09" "2020-08-12" "2020-08-14"
#&gt; [16] "2020-08-19" "2020-08-24" "2020-08-28" "2020-08-29"</code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotting a harmonized Landsat image from the merged dataset</span></span>
<span><span class="co"># plot the cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">hls_cube_merged</span>,</span>
<span>  red <span class="op">=</span> <span class="st">"RED"</span>,</span>
<span>  green <span class="op">=</span> <span class="st">"GREEN"</span>,</span>
<span>  blue <span class="op">=</span> <span class="st">"BLUE"</span>,</span>
<span>  date <span class="op">=</span> <span class="st">"2020-07-11"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:hlsmerge"></span>
<img src="images/hls_ilhabela_l8.png" alt="Plot of Sentinel-2 image obtained from merging NASA HLS collection and Sentinel-2 collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast (&amp;copy; EU Copernicus Sentinel Programme; source: NASA)." width="100%"><p class="caption">
Figure 28: Plot of Sentinel-2 image obtained from merging NASA HLS collection and Sentinel-2 collection for date 2020-06-15 showing the island of Ilhabela in the Brazilian coast (© EU Copernicus Sentinel Programme; source: NASA).
</p>
</div>
</div>
<div id="eo-products-from-terrascope" class="section level2 unnumbered">
<h2>EO products from TERRASCOPE<a class="anchor" aria-label="anchor" href="#eo-products-from-terrascope"><i class="fas fa-link"></i></a>
</h2>
<p>Terrascope is online platform for accessing open-source satellite images. This service, operated by VITO, offers a range of Earth observation data and processing services that are accessible free of charge. Currently, <code>sits</code> supports the World Cover 2021 maps, produced by VITO with support form the European Commission and ESA. The following code shows how to access the World Cover 2021 convering tile “22LBL”. The first step is to use <code><a href="https://rdrr.io/pkg/sits/man/sits_mgrs_to_roi.html">sits_mgrs_to_roi()</a></code> to get the region of interest expressed as a bounding box; this box is then entered as the <code>roi</code> parameter in the <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> function. Since the World Cover data is available as a 3<span class="math inline">\(^\circ\)</span> by 3<span class="math inline">\(^\circ\)</span> grid, it is necessary to use <code><a href="https://rdrr.io/pkg/sits/man/sits_cube_copy.html">sits_cube_copy()</a></code> to extract the exact MGRS tile.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get roi for an MGRS tile</span></span>
<span><span class="va">bbox_22LBL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_mgrs_to_roi.html">sits_mgrs_to_roi</a></span><span class="op">(</span><span class="st">"22LBL"</span><span class="op">)</span></span>
<span><span class="co"># retrieve the world cover map for the chosen roi</span></span>
<span><span class="va">world_cover_2021</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"TERRASCOPE"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"WORLD-COVER-2021"</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">bbox_22LBL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># cut the 3 x 3 degree grid to match the MGRS tile 22LBL</span></span>
<span><span class="va">world_cover_2021_20LBL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube_copy.html">sits_cube_copy</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">world_cover_2021</span>,</span>
<span>  roi <span class="op">=</span> <span class="va">bbox_22LBL</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot the resulting map</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">world_cover_2021_20LBL</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:worldcover"></span>
<img src="images/world_cover_2021.png" alt="Plot of World Cover 2021 map covering MGRS tile 22LBL (&amp;copy; TerraScope)." width="100%"><p class="caption">
Figure 29: Plot of World Cover 2021 map covering MGRS tile 22LBL (© TerraScope).
</p>
</div>
</div>
<div id="planet-data-as-ard-local-files" class="section level2 unnumbered">
<h2>Planet data as ARD local files<a class="anchor" aria-label="anchor" href="#planet-data-as-ard-local-files"><i class="fas fa-link"></i></a>
</h2>
<p>ARD images downloaded from cloud collections to a local computer are not associated with a STAC endpoint that describes them. They must be organized and named to allow <code>sits</code> to create a data cube from them. All local files have to be in the same directory and have the same spatial resolution and projection. Each file must contain a single image band for a single date. Each file name needs to include tile, date, and band information. Users must provide information about the original data source to allow <code>sits</code> to retrieve information about image attributes such as band names, missing values, etc. When working with local cubes, <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code> needs the following parameters:</p>
<ul>
<li>
<code>source</code>: Name of the original data provider; for a list of providers and collections, use <code><a href="https://rdrr.io/pkg/sits/man/sits_list_collections.html">sits_list_collections()</a></code>.</li>
<li>
<code>collection</code>: Collection from where the data was extracted.</li>
<li>
<code>data_dir</code>: Local directory for images.</li>
<li>
<code>bands</code>: Optional parameter to describe the bands to be retrieved.</li>
<li>
<code>parse_info</code>: Information to parse the file names. File names need to contain information on tile, date, and band, separated by a delimiter (usually <code>"_"</code>).</li>
<li>
<code>delim</code>: Separator character between descriptors in the file name (default is <code>"_"</code>).</li>
</ul>
<p>To be able to read local files, they must belong to a collection registered by <code>sits</code>. All collections known to <code>sits</code> by default are shown using <code><a href="https://rdrr.io/pkg/sits/man/sits_list_collections.html">sits_list_collections()</a></code>. To register a new collection, please see the information provided in the Technical Annex.</p>
<p>The example shows how to define a data cube using Planet images from the <code>sitsdata</code> package. The dataset contains monthly PlanetScope mosaics for tile “604-1043” for August to October 2022, with bands B01, B02, B04, and B04.</p>
<p>In general, <code>sits</code> users need to match the local file names to the values provided by the <code>parse_info</code> parameter. The file names of this dataset use the format <code>PLANETSCOPE_MOSAIC_604-1043_B4_2022-10-01.tif</code>, which fits the default value for <code>parse_info</code> which is <code>c("source", "collection", "tile", "band", "date")</code> and for <code>delim</code> which is “_“, it is not necessary to set these values when creating a data cube from the local files.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the directory where Planet files are stored</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Planet"</span>, package <span class="op">=</span> <span class="st">"sitsdata"</span><span class="op">)</span></span>
<span><span class="co"># Create a data cube from local files</span></span>
<span><span class="va">planet_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"PLANET"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"MOSAIC"</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the first instance of the Planet data in natural colors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">planet_cube</span>, red <span class="op">=</span> <span class="st">"B3"</span>, green <span class="op">=</span> <span class="st">"B2"</span>, blue <span class="op">=</span> <span class="st">"B1"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:planet"></span>
<img src="images/planet.png" alt="Planet image over an area in Colombia (&amp;copy; Planet - reproduction based on fair use doctrine)." width="100%"><p class="caption">
Figure 30: Planet image over an area in Colombia (© Planet - reproduction based on fair use doctrine).
</p>
</div>
</div>
<div id="reading-classified-images-as-local-data-cube" class="section level2 unnumbered">
<h2>Reading classified images as local data cube<a class="anchor" aria-label="anchor" href="#reading-classified-images-as-local-data-cube"><i class="fas fa-link"></i></a>
</h2>
<p>It is also possible to create local cubes based on results that have been produced by classification or post-classification algorithms. In this case, more parameters are required, and the parameter <code>parse_info</code> is specified differently, as follows:</p>
<ul>
<li>
<code>source</code>: Name of the original data provider.</li>
<li>
<code>collection</code>: Name of the collection from where the data was extracted.</li>
<li>
<code>data_dir</code>: Local directory for the classified images.</li>
<li>
<code>band</code>: Band name associated with the type of result. Use: (a) <code>probs</code> for probability cubes produced by <code><a href="https://rdrr.io/pkg/sits/man/sits_classify.html">sits_classify()</a></code>; (b) <code>bayes</code>, for cubes produced by <code><a href="https://rdrr.io/pkg/sits/man/sits_smooth.html">sits_smooth()</a></code>; (c) <code>entropy</code>, <code>least</code>, <code>ratio</code> or <code>margin</code>, according to the method selected when using <code><a href="https://rdrr.io/pkg/sits/man/sits_uncertainty.html">sits_uncertainty()</a></code>; and (d) <code>class</code> for classified cubes.</li>
<li>
<code>labels</code>: Labels associated with the names of the classes (not required for cubes produced by <code><a href="https://rdrr.io/pkg/sits/man/sits_uncertainty.html">sits_uncertainty()</a></code>).</li>
<li>
<code>version</code>: Version of the result (default = <code>v1</code>).</li>
<li>
<code>parse_info</code>: File name parsing information to allow <code>sits</code> to deduce the values of <code>tile</code>, <code>start_date</code>, <code>end_date</code>, <code>band</code>, and <code>version</code> from the file name. Unlike non-classified image files, cubes produced by classification and post-classification have both <code>start_date</code> and <code>end_date</code>.</li>
</ul>
<p>The following code creates a results cube based on the classification of deforestation in Brazil. This classified cube was obtained by a large data cube of Sentinel-2 images, covering the state of Rondonia, Brazil comprising 40 tiles, 10 spectral bands, and covering the period from 2020-06-01 to 2021-09-11. Samples of four classes were trained by a random forest classifier. Internally, classified images use integers to represent classes. Thus, labels have to be associated to the integers that represent each class name.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a cube based on a classified image</span></span>
<span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata/Rondonia-20LLP"</span>,</span>
<span>  package <span class="op">=</span> <span class="st">"sitsdata"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># File name  "SENTINEL-2_MSI_20LLP_2020-06-04_2021-08-26_class_v1.tif"</span></span>
<span><span class="va">Rondonia_class_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"AWS"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-S2-L2A-COGS"</span>,</span>
<span>  bands <span class="op">=</span> <span class="st">"class"</span>,</span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"1"</span> <span class="op">=</span> <span class="st">"Burned_Area"</span>, <span class="st">"2"</span> <span class="op">=</span> <span class="st">"Cleared_Area"</span>,</span>
<span>    <span class="st">"3"</span> <span class="op">=</span> <span class="st">"Highly_Degraded"</span>, <span class="st">"4"</span> <span class="op">=</span> <span class="st">"Forest"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data_dir <span class="op">=</span> <span class="va">data_dir</span>,</span>
<span>  parse_info <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"satellite"</span>, <span class="st">"sensor"</span>, <span class="st">"tile"</span>, <span class="st">"start_date"</span>, <span class="st">"end_date"</span>,</span>
<span>    <span class="st">"band"</span>, <span class="st">"version"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Plot the classified cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Rondonia_class_cube</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:mapdata"></span>
<img src="04-datacubes_files/figure-html/mapdata-1.png" alt="Classified data cube for the year 2020/2021 in Rondonia, Brazil (&amp;copy; EU Copernicus Sentinel Programme; source: authors)." width="100%"><p class="caption">
Figure 31: Classified data cube for the year 2020/2021 in Rondonia, Brazil (© EU Copernicus Sentinel Programme; source: authors).
</p>
</div>
</div>
<div id="regularizing-data-cubes" class="section level2 unnumbered">
<h2>Regularizing data cubes<a class="anchor" aria-label="anchor" href="#regularizing-data-cubes"><i class="fas fa-link"></i></a>
</h2>
<p>ARD collections available in AWS, MPC, USGS, and DEAFRICA are not regular in space and time. Bands may have different resolutions, images may not cover the entire tile, and time intervals are irregular. For this reason, data from these collections need to be converted to regular data cubes by calling <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code>, which uses the <em>gdalcubes</em> package <span class="citation"><a href="references.html#ref-Appel2019">[6]</a></span>. After obtaining a regular data cube, users can perform data analysis and classification operations, as shown in the following chapters.</p>
<div id="regularizing-sentinel-2-images" class="section level3 unnumbered">
<h3>Regularizing Sentinel-2 images<a class="anchor" aria-label="anchor" href="#regularizing-sentinel-2-images"><i class="fas fa-link"></i></a>
</h3>
<p>In the following example, the user has created an irregular data cube from the Sentinel-2 collection available in Microsoft’s Planetary Computer (MPC) for tiles <code>20LKP</code> and <code>20LLP</code> in the state of Rondonia, Brazil. We first build an irregular data cube using <code><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube()</a></code>.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Creating an irregular data cube from MPC</span></span>
<span><span class="va">s2_cube_rondonia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"20LKP"</span>, <span class="st">"20LLP"</span><span class="op">)</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-06-30"</span><span class="op">)</span>,</span>
<span>  end_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">"2018-08-31"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Show the different timelines of the cube tiles</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">s2_cube_rondonia</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; $`20LKP`
#&gt;  [1] "2018-07-03" "2018-07-08" "2018-07-13" "2018-07-18" "2018-07-23"
#&gt;  [6] "2018-07-28" "2018-08-02" "2018-08-07" "2018-08-12" "2018-08-17"
#&gt; [11] "2018-08-22" "2018-08-27"
#&gt; 
#&gt; $`20LLP`
#&gt;  [1] "2018-06-30" "2018-07-03" "2018-07-05" "2018-07-08" "2018-07-10"
#&gt;  [6] "2018-07-13" "2018-07-15" "2018-07-18" "2018-07-20" "2018-07-23"
#&gt; [11] "2018-07-25" "2018-07-28" "2018-07-30" "2018-08-02" "2018-08-04"
#&gt; [16] "2018-08-07" "2018-08-09" "2018-08-12" "2018-08-14" "2018-08-17"
#&gt; [21] "2018-08-19" "2018-08-22" "2018-08-24" "2018-08-27" "2018-08-29"</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the first image of the irregular cube</span></span>
<span><span class="va">s2_cube_rondonia</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tile</span> <span class="op">==</span> <span class="st">"20LLP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>red <span class="op">=</span> <span class="st">"B11"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>, date <span class="op">=</span> <span class="st">"2018-07-03"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-27"></span>
<img src="04-datacubes_files/figure-html/unnamed-chunk-27-1.png" alt="Sentinel-2 tile 20LLP for date 2018-07-03 (&amp;copy; EU Copernicus Sentinel Programme; source: authors)." width="100%"><p class="caption">
Figure 32: Sentinel-2 tile 20LLP for date 2018-07-03 (© EU Copernicus Sentinel Programme; source: authors).
</p>
</div>
<p>Because of the different acquisition orbits of the Sentinel-2 and Sentinel-2A satellites, the two tiles also have different timelines. Tile <code>20LKP</code> has 12 instances, while tile <code>20LLP</code> has 24 instances for the chosen period. The function <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> builds a data cube with a regular timeline and a best estimate of a valid pixel for each interval. The <code>period</code> parameter sets the time interval between two images. Values of <code>period</code> use the ISO8601 time period specification, which defines time intervals as <code>P[n]Y[n]M[n]D</code>, where “Y” stands for years, “M” for months, and “D” for days. Thus, <code>P1M</code> stands for a one-month period, <code>P15D</code> for a fifteen-day period. When joining different images to get the best image for a period, <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> uses an aggregation method that organizes the images for the chosen interval in order of increasing cloud cover and then selects the first cloud-free pixel. In the example, we use a small spatial resolution for the regular cube to speed up processing; in actual case, we suggest using a 10-meter spatial resolution for the cube.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Regularize the cube to 15 day intervals</span></span>
<span><span class="va">reg_cube_rondonia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>  cube       <span class="op">=</span> <span class="va">s2_cube_rondonia</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4"</span>,</span>
<span>  res        <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  period     <span class="op">=</span> <span class="st">"P16D"</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">6</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the first image of the tile 20LLP of the regularized cube</span></span>
<span><span class="co"># The pixels of the regular data cube cover the full MGRS tile</span></span>
<span><span class="va">reg_cube_rondonia</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tile</span> <span class="op">==</span> <span class="st">"20LLP"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>red <span class="op">=</span> <span class="st">"B11"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B02"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:senroreg"></span>
<img src="04-datacubes_files/figure-html/senroreg-1.png" alt="Regularized image for tile Sentinel-2 tile 20LLP (&amp;copy; EU Copernicus Sentinel Programme; source: authors)." width="100%"><p class="caption">
Figure 33: Regularized image for tile Sentinel-2 tile 20LLP (© EU Copernicus Sentinel Programme; source: authors).
</p>
</div>
</div>
<div id="regularizing-sentinel-1-images" class="section level3 unnumbered">
<h3>Regularizing Sentinel-1 images<a class="anchor" aria-label="anchor" href="#regularizing-sentinel-1-images"><i class="fas fa-link"></i></a>
</h3>
<p>Because of their acquisition mode, SAR images are usually stored following their geometry of acquisition, which is inclined with respect to the Earth. This is the case of GRD and RTC collections available in Microsoft Planetary Computer (MPC). To allow easier use of Sentinel-1 data and to merge them with Sentinel-2 images, regularization in sits reprojects SAR data to the MGRS grid, as shown in the following example. The example uses the “SENTINEL-1-RTC” collection from MPC. Readers that do not have a subscription can replace “SENTINEL-1-RTC” with “SENTINEL-1-GRD” in the example.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create an RTC cube from MPC collection for a region in Mato Grosso, Brazil.</span></span>
<span><span class="va">cube_s1_rtc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-1-RTC"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"VV"</span>, <span class="st">"VH"</span><span class="op">)</span>,</span>
<span>  orbit <span class="op">=</span> <span class="st">"descending"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"22LBL"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-06-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-10-01"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s1_rtc</span>, band <span class="op">=</span> <span class="st">"VH"</span>, palette <span class="op">=</span> <span class="st">"Greys"</span>, scale <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:sargrdorig"></span>
<img src="images/cube_s1_rtc_tile_22LBL.png" alt="Original Sentinel-1 image covering tile 22LBL (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft)." width="100%"><p class="caption">
Figure 34: Original Sentinel-1 image covering tile 22LBL (© EU Copernicus Sentinel Programme; source: Microsoft).
</p>
</div>
<p>After creating an irregular data cube from the data available in MPC, we use <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> to produce a SAR data cube that matches MGRS tile “22LBL”. For plotting the SAR image, we select a multidate plot for the “VH” band, where the first date will be displayed in red, the second in green and the third in blue, so as to show an RGB map where changes are visually enhanced.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define the output directory</span></span>
<span><span class="co"># # Create a directory to store files</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"./tempdir/chp4/sar"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"./tempdir/chp4/sar"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># create a regular RTC cube from MPC collection for a tile 22LBL.</span></span>
<span><span class="va">cube_s1_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">cube_s1_rtc</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"P16D"</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"22LBL"</span><span class="op">)</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4/sar"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s1_reg</span>,</span>
<span>  band <span class="op">=</span> <span class="st">"VH"</span>, palette <span class="op">=</span> <span class="st">"Greys"</span>, scale <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2021-06-06"</span>, <span class="st">"2021-07-24"</span>, <span class="st">"2021-09-26"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:sarrtcreg"></span>
<img src="images/cube_s1_rtc_tile_22LBL_reg_rgb.png" alt="Regular Sentinel-1 image covering tile 22LBL (&amp;copy; EU Copernicus Sentinel Programme; source: Microsoft)." width="100%"><p class="caption">
Figure 35: Regular Sentinel-1 image covering tile 22LBL (© EU Copernicus Sentinel Programme; source: Microsoft).
</p>
</div>
</div>
<div id="merging-sentinel-1-and-sentinel-2-images" class="section level3 unnumbered">
<h3>Merging Sentinel-1 and Sentinel-2 images<a class="anchor" aria-label="anchor" href="#merging-sentinel-1-and-sentinel-2-images"><i class="fas fa-link"></i></a>
</h3>
<p>To combine Sentinel-1 and Sentinel-2 data, the first step is to produce regular data cubes for the same MGRS tiles with compatible time steps. The timelines do not have to be exactly the same, but they need to be close enough so that matching is acceptable and have the same number of time steps. This example uses the regular Sentinel-1 cube for tile “22LBL” produced in the previous sections. The next step is to produce a regular Sentinel-2 data cube for the same tile and regularize it. The cube below defines an irregular data cube retrieved from Planetary Computer.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define the output directory</span></span>
<span><span class="va">cube_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B02"</span>, <span class="st">"B8A"</span>, <span class="st">"B11"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"22LBL"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-06-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-09-30"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s2</span>, red <span class="op">=</span> <span class="st">"B11"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B02"</span>, date <span class="op">=</span> <span class="st">"2021-07-07"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:senlbl"></span>
<img src="images/s2_tile_22LBL.png" alt="Sentinel-2 image covering tile 22LBL (&amp;copy; EU Copernicus Sentinel Programme; source: authors)." width="100%"><p class="caption">
Figure 36: Sentinel-2 image covering tile 22LBL (© EU Copernicus Sentinel Programme; source: authors).
</p>
</div>
<p>The next step is to create a regular data cube for tile “20LBL”.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"./tempdir/chp4/s2_opt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"./tempdir/chp4/s2_opt"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># define the output directory</span></span>
<span><span class="va">cube_s2_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">cube_s2</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"P16D"</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  tiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"22LBL"</span><span class="op">)</span>,</span>
<span>  memsize <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  multicores <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4/s2_opt"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After creating the two regular cubes, we can merge them. Before this step, one should first compare their timelines to see if they match. Timelines of regular cubes are constrained by acquisition dates, which in the case of Sentinel-1 and Sentinel-2 are different. Attentive readers will have noticed that the start and end dates of the cubes selected from the Planetary Computer (see code above) are slightly difference, because of the need to ensure both regular cubes have the same number of time steps. The timelines for both cubes are shown below.</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># timeline of the Sentinel-2 cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">cube_s2_reg</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; [1] "2021-06-02" "2021-06-18" "2021-07-04" "2021-07-20" "2021-08-05"
#&gt; [6] "2021-08-21" "2021-09-06" "2021-09-22"</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># timeline of the Sentinel-2 cube</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_timeline.html">sits_timeline</a></span><span class="op">(</span><span class="va">cube_s1_reg</span><span class="op">)</span></span></code></pre></div>
<pre><code>#&gt; [1] "2021-06-06" "2021-06-22" "2021-07-08" "2021-07-24" "2021-08-09"
#&gt; [6] "2021-08-25" "2021-09-10" "2021-09-26"</code></pre>
<p>Considering that the timelines are close enough so that the cubes can be combined, we can use the <code>sits_merge</code> function to produce a combined cube. As an example, we show a plot with both radar and optical bands.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># merge Sentinel-1 and Sentinel-2 cubes</span></span>
<span><span class="va">cube_s1_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_merge.html">sits_merge</a></span><span class="op">(</span><span class="va">cube_s2_reg</span>, <span class="va">cube_s1_reg</span><span class="op">)</span></span>
<span><span class="co"># plot a an image with both SAR and optical bands</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cube_s1_s2</span>, red <span class="op">=</span> <span class="st">"B11"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"VH"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:saropt"></span>
<img src="04-datacubes_files/figure-html/saropt-1.png" alt="Sentinel-2 and Sentinel-1 RGB composite for tile 22LBL (source: authors)." width="100%"><p class="caption">
Figure 37: Sentinel-2 and Sentinel-1 RGB composite for tile 22LBL (source: authors).
</p>
</div>
</div>
</div>
<div id="combining-multitemporal-data-cubes-with-digital-elevation-models" class="section level2 unnumbered">
<h2>Combining multitemporal data cubes with digital elevation models<a class="anchor" aria-label="anchor" href="#combining-multitemporal-data-cubes-with-digital-elevation-models"><i class="fas fa-link"></i></a>
</h2>
<p>In many applications, especially in regions with large topographical, soil or climatic variations, is is useful to merge multitemporal data cubes with base information such as digital elevation models (DEM). Merging multitemporal satellite images with digital elevation models (DEMs) offers several advantages that enhance the analysis and interpretation of geospatial data. Elevation data provides an additional to the two-dimensional satellite images, which help to distinguish land use and land cover classes which are impacted by altitude gradients. One example is the capacity to distinguish between low-altitude and high-altitude forests. In case where topography changes significantly, DEM information can improve the accuracy of classification algorithms.</p>
<p>As an example of DEM integation in a data cube, we will consider an agricultural region of Chile which is located in a narrow area close to the Andes. There is a steep gradient so that the cube benefits from the inclusion of the DEM.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2_cube_19HBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"SENTINEL-2-L2A"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"19HBA"</span>,</span>
<span>  bands <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"B04"</span>, <span class="st">"B8A"</span>, <span class="st">"B12"</span>, <span class="st">"CLOUD"</span><span class="op">)</span>,</span>
<span>  start_date <span class="op">=</span> <span class="st">"2021-01-01"</span>,</span>
<span>  end_date <span class="op">=</span> <span class="st">"2021-03-31"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">s2_cube_19HBA</span>, red <span class="op">=</span> <span class="st">"B12"</span>, green <span class="op">=</span> <span class="st">"B8A"</span>, blue <span class="op">=</span> <span class="st">"B04"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:unnamed-chunk-35"></span>
<img src="images/s2_19HBA.png" alt="Sentinel-2 image covering tile 19HBA (source: authors)." width="100%"><p class="caption">
Figure 38: Sentinel-2 image covering tile 19HBA (source: authors).
</p>
</div>
<p>Then, we produce a regular data cube to use for classification. In this example, we will use a reduced resolution (30 meters) to expedite processing. In practice, a resolution of 10 meters is recommended.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s2_cube_19HBA_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">s2_cube_19HBA</span>,</span>
<span>  period <span class="op">=</span> <span class="st">"P16D"</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4/s2_19HBA"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The next step is recover the DEM for the area. For this purpose, we will use the Copernicus Global DEM-30, and select the area covered by the tile. As explained in the MPC access section above, the Copernicus DEM tiles are stored as 1<span class="math inline">\(^\circ\)</span> by 1<span class="math inline">\(^\circ\)</span> grid. For them to match an MGRS tile, they have to be regularized in a similar way as the Sentinel-1 images, as shown below. To select a DEM, no temporal information is required.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># obtain the DEM cube for</span></span>
<span><span class="va">dem_cube_19HBA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_cube.html">sits_cube</a></span><span class="op">(</span></span>
<span>  source <span class="op">=</span> <span class="st">"MPC"</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"COP-DEM-GLO-30"</span>,</span>
<span>  bands <span class="op">=</span> <span class="st">"ELEVATION"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"19HBA"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After obtaining the 1<span class="math inline">\(^\circ\)</span> by 1<span class="math inline">\(^\circ\)</span> data cube covering the selected tile, the next step is to regularize it. This is done using the <code><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize()</a></code> function. This function will produce a DEM which matches exactly the chosen tile.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># obtain the DEM cube for</span></span>
<span><span class="va">dem_cube_19HBA_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_regularize.html">sits_regularize</a></span><span class="op">(</span></span>
<span>  cube <span class="op">=</span> <span class="va">dem_cube_19HBA</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">30</span>,</span>
<span>  bands <span class="op">=</span> <span class="st">"ELEVATION"</span>,</span>
<span>  tiles <span class="op">=</span> <span class="st">"19HBA"</span>,</span>
<span>  output_dir <span class="op">=</span> <span class="st">"./tempdir/chp4/dem_19HBA"</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot the DEM reversing the palette</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dem_cube_19HBA_reg</span>, band <span class="op">=</span> <span class="st">"ELEVATION"</span>, palette <span class="op">=</span> <span class="st">"Spectral"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:demchile"></span>
<img src="images/demchile.png" alt="Copernicus DEM-30 covering tile 19HBA (&amp;copy; DLR e.V. 2010-2014 and &amp;copy Airbus Defence and Space GmbH 2014-2018 provided under COPERNICUS by the European Union and ESA; source: Microsoft and authors)." width="100%"><p class="caption">
Figure 39: Copernicus DEM-30 covering tile 19HBA (© DLR e.V. 2010-2014 and &amp;copy Airbus Defence and Space GmbH 2014-2018 provided under COPERNICUS by the European Union and ESA; source: Microsoft and authors).
</p>
</div>
<p>After obtaining regular data cubes from satellite images and from DEMs, there are two ways to combine them. One option is to take the DEM band as a multitemporal information, and duplicate this band for every time step so that the DEM becomes one additional time series. The alternative is to use DEMs as base cubes, and take them as a single additional band. These options are discusses in what follows.</p>
</div>
<div id="merging-multitemporal-data-cubes-with-dem" class="section level2 unnumbered">
<h2>Merging multitemporal data cubes with DEM<a class="anchor" aria-label="anchor" href="#merging-multitemporal-data-cubes-with-dem"><i class="fas fa-link"></i></a>
</h2>
<p>There are two ways to combine multitemporal data cubes with DEM data. The first method takes the DEM as a base information, which is used in combination with the multispectral time series. For exemple, consider a situation of a data cube with 10 bands and 23 time steps, which has a 230-dimensional space. Adding DEM as a base cube will include one dimension to the attribute space. This combination is supported by function <code>sits_add_base_cube</code>. In the resulting cube, the information on the image time series and that of the DEM are stored separately. The data cube metadata will now include a column called <code>base_info</code>.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged_cube_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_add_base_cube.html">sits_add_base_cube</a></span><span class="op">(</span><span class="va">s2_cube_19HBA_reg</span>, <span class="va">dem_cube_19HBA_reg</span><span class="op">)</span></span>
<span><span class="va">merged_cube_base</span><span class="op">$</span><span class="va">base_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 11
#&gt;   source collection     satellite sensor  tile    xmin   xmax   ymin  ymax crs  
#&gt;   &lt;chr&gt;  &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;
#&gt; 1 MPC    COP-DEM-GLO-30 TANDEM-X  X-band… 19HBA 199980 309780 5.99e6 6.1e6 EPSG…
#&gt; # ℹ 1 more variable: file_info &lt;list&gt;</code></pre>
<p>Although this combination is conceptually simple, it has drawbacks. Since the attribute space now mixes times series with fixed-time information, the only applicable classification method is random forests. Because of the way random forest works, not all attributes are used by every decision tree. During the training of each tree, at each node, a random subset of features is selected, and the best split is chosen based on this subset rather than all features. Thus, there may be a significant number of decision trees that do use the DEM attribute. As a result, the effect of the DEM information may be underestimated.</p>
<p>The alternative is to combine the image data cube and the DEM using <code>sits_merge</code>. In this case, the DEM becomes another band. Although it may look peculiar to replicate the DEM many time to build an artificial time series, there are many advantages in doing so. All classification algorithms available in <code>sits</code> (including the deep learning ones) can be used to classify the resulting cube. For cases where the DEM information is particularly important, such organisation places DEM data at a par with other spectral bands. Users are encouraged to compare the results obtained by direct merging of DEM with spectral bands with the method where DEM is taken as a base cube.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged_cube</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sits/man/sits_merge.html">sits_merge</a></span><span class="op">(</span><span class="va">s2_cube_19HBA_reg</span>, <span class="va">dem_cube_19HBA_reg</span><span class="op">)</span></span>
<span><span class="va">merged_cube</span><span class="op">$</span><span class="va">file_info</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code>#&gt; # A tibble: 24 × 13
#&gt;    fid   band      date       nrows ncols  xres  yres   xmin   ymin   xmax  ymax
#&gt;    &lt;chr&gt; &lt;chr&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1 1     B04       2021-01-03  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  2 1     B12       2021-01-03  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  3 1     B8A       2021-01-03  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  4 1     ELEVATION 2021-01-03  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  5 2     B04       2021-01-19  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  6 2     B12       2021-01-19  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  7 2     B8A       2021-01-19  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  8 1     ELEVATION 2021-01-19  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt;  9 3     B04       2021-02-04  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt; 10 3     B12       2021-02-04  3660  3660    30    30 199980 5.99e6 309780 6.1e6
#&gt; # ℹ 14 more rows
#&gt; # ℹ 2 more variables: crs &lt;chr&gt;, path &lt;chr&gt;</code></pre>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="introduction.html">Introduction</a></div>
<div class="next"><a href="operations-on-data-cubes.html">Operations on data cubes</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#earth-observation-data-cubes">Earth observation data cubes</a></li>
<li><a class="nav-link" href="#analysis-ready-dataard">Analysis-ready data(ARD)</a></li>
<li><a class="nav-link" href="#image-collections-handled-by-sits">Image collections handled by sits</a></li>
<li><a class="nav-link" href="#regular-image-data-cubes">Regular image data cubes</a></li>
<li><a class="nav-link" href="#creating-data-cubes">Creating data cubes</a></li>
<li><a class="nav-link" href="#amazon-web-services">Amazon Web Services</a></li>
<li>
<a class="nav-link" href="#microsoft-planetary-computer">Microsoft Planetary Computer</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sentinel-22a-images-in-mpc">SENTINEL-2/2A images in MPC</a></li>
<li><a class="nav-link" href="#landsat-c2-l2-images-in-mpc">LANDSAT-C2-L2 images in MPC</a></li>
<li><a class="nav-link" href="#sentinel-1-grd-images-in-mpc">SENTINEL-1-GRD images in MPC</a></li>
<li><a class="nav-link" href="#sentinel-1-rtc-images-in-mpc">SENTINEL-1-RTC images in MPC</a></li>
<li><a class="nav-link" href="#copernicus-dem-30-meter-images-in-mpc">Copernicus DEM 30 meter images in MPC</a></li>
</ul>
</li>
<li><a class="nav-link" href="#brazil-data-cube">Brazil Data Cube</a></li>
<li>
<a class="nav-link" href="#copernicus-data-space-ecosystem-cdse">Copernicus Data Space Ecosystem (CDSE)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sentinel-22a-images-in-cdse">SENTINEL-2/2A images in CDSE</a></li>
<li><a class="nav-link" href="#sentinel-1-rtc-images-in-cdse">SENTINEL-1-RTC images in CDSE</a></li>
</ul>
</li>
<li><a class="nav-link" href="#digital-earth-africa">Digital Earth Africa</a></li>
<li><a class="nav-link" href="#digital-earth-australia">Digital Earth Australia</a></li>
<li><a class="nav-link" href="#harmonized-landsat-sentinel">Harmonized Landsat-Sentinel</a></li>
<li><a class="nav-link" href="#eo-products-from-terrascope">EO products from TERRASCOPE</a></li>
<li><a class="nav-link" href="#planet-data-as-ard-local-files">Planet data as ARD local files</a></li>
<li><a class="nav-link" href="#reading-classified-images-as-local-data-cube">Reading classified images as local data cube</a></li>
<li>
<a class="nav-link" href="#regularizing-data-cubes">Regularizing data cubes</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#regularizing-sentinel-2-images">Regularizing Sentinel-2 images</a></li>
<li><a class="nav-link" href="#regularizing-sentinel-1-images">Regularizing Sentinel-1 images</a></li>
<li><a class="nav-link" href="#merging-sentinel-1-and-sentinel-2-images">Merging Sentinel-1 and Sentinel-2 images</a></li>
</ul>
</li>
<li><a class="nav-link" href="#combining-multitemporal-data-cubes-with-digital-elevation-models">Combining multitemporal data cubes with digital elevation models</a></li>
<li><a class="nav-link" href="#merging-multitemporal-data-cubes-with-dem">Merging multitemporal data cubes with DEM</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><strong>sits</strong>: Satellite Image Time Series Analysis on Earth Observation Data Cubes</strong>" was written by Gilberto Camara, Rolf Simoes, Felipe Souza, Felipe Menino, Charlotte Pelletier, Pedro R. Andrade, Karine Ferreira, Gilberto Queiroz. It was last built on 2024-09-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
